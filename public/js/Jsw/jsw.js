!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){var o=n(4),i=o.jSW,s=o.dMgr,r=s.ClaimModule("jSWProtocol"),a=s.ClaimModule("jSWUtils"),l=s.ClaimModule("jSWOptions"),u=s.ClaimModule("PuLoad"),c=s.ClaimModule("AudioMgr"),_=s.ClaimModule("HTTPNruFile");e.exports={jSWProtocol:r,jSWUtils:a,jSWOptions:l,PuLoad:u,AudioMgr:c,HTTPNruFile:_,jSW:i}},function(e,t,n){e.exports=n(3)},function(e,t,n){"use strict";n.r(t);var o=n(1),i=n.n(o);i.a.version=Object({SdkVer:"2020-10-16 17:02:50",ReqOcxVer:"2020-10-16 16:56:13",WebSerMidVer:"2020-10-16 17:00:55"}),console.log(""),console.log("JSW Version Info, You Can Find That Here: jSW['version']"),console.log("                  Sdk 2020-10-16 17:02:50"),console.log("          Require Ocx 2020-10-16 16:56:13"),console.log("Web Server Middleware 2020-10-16 17:00:55"),console.log(""),window.jSW=i.a},function(e,t,n){var o=n(0).jSW;n(6),n(7),n(8),n(9),n(10),n(11),n(12),n(13),n(14),e.exports=o},function(module,exports,__webpack_require__){var jSW={},module_entry=__webpack_require__(5),ProModules=module_entry.ProModules,ProHttpDepends=module_entry.ProHttpDepends,ProOcxDepends=module_entry.ProOcxDepends,ModuleDepends=module_entry.ModuleDepends,DependencyMgr=new function(){var _that=this,DependencyModuleName="DependCollection",AfterAsyncLoadHasResult=function(e){var t=e.getPath();null==t?e.emit():AsyncLoadJsCss(t,AfterAsyncLoadHasResult,e)},AsyncLoadJsCss=function(e,t,n){var o=null,i=null;e.indexOf(".js")>0?((o=document.createElement("script")).src=e,i=DependencyMgr.GetJsEleContainer()):e.indexOf(".css")>0&&((o=document.createElement("link")).type="text/css",o.rel="stylesheet",o.href=e,i=document.head),o&&(o.onload=function(){t(n),"text/css"!=o.type&&o.parentElement.removeChild(o)},i.appendChild(o))},LoadJsOrScript=function(e,t,n){var o=e;return!!window.XMLHttpRequest&&(AfterAsyncLoadHasResult({szPaths:o,index:0,lastIndex:0,getPath:function(){return this.index<this.szPaths.length?(this.lastIndex=this.index,this.index++,this.szPaths[this.lastIndex]):null},onResult:t,emit:function(){this.onResult&&this.onResult(this.tag)},tag:n}),!0)},ModuleInfo=function(e,t){this.names=e,this.promise=t,this.szNames=null},loadGetPaths=function(e,t){return new ModuleInfo(e,t).GetAbsPath()},loadDependsProxy=function(e,t,n,o){var i=loadGetPaths(e,t);return LoadJsOrScript(i,n,o)},RegModule=function(e,t,n){return null==GetDependModuleCollection()[e]?(SetModuleReged(e,!0),n||ConsoleLogRegModel(e),GetDependModuleCollection()[e]=t):console.error("load dependency error"),t},ConsoleLogRegModel=function(e){console.log("[D] RegModule "+e)},GetDependModuleCollection=function(){return void 0===_that[DependencyModuleName]&&(_that[DependencyModuleName]={}),_that[DependencyModuleName]},GetModuleInfo=function(e){var t=e+"_info";return void 0===GetDependModuleCollection()[t]&&(GetDependModuleCollection()[t]={}),GetDependModuleCollection()[t]},SetModuleInfo=function(e,t,n){GetModuleInfo(e)[t]=n},InjectModule=function(e,t){return t(e)},SyncGetModule=function(e){return _that[DependencyModuleName][e]},GetModuleEntiey=function(e,t){return void 0===_that[DependencyModuleName]&&(_that[DependencyModuleName]={}),_that[DependencyModuleName][t]},CheckModuleReged=function(e){return GetModuleInfo(e).bloaded},SetModuleReged=function(e,t){SetModuleInfo(e,"bloaded",t)},GetRegedModule=function(e,t,n){var o=GetModuleEntiey(DependencyModuleName,e);if(o&&CheckModuleReged(e))return InjectModule(o,n);loadDependsProxy([t],null,(function(){var t=GetModuleEntiey(DependencyModuleName,e);InjectModule(t,n)}),null)};function onLoadResultProxy(e,t){LoadModuleByModeleInfo(LoadModulesInfo,e,t)}this.jswGetDependUrl=function(e){return loadGetPaths([e="thlib/"+e])[0]},this.GetJsEleContainer=function(){return document.body},this.LoadProDepends=function(e,t){var n=ProModules.paths,o=ProModules.names;return loadDependsProxy(n,o,onLoadResultProxy(e,t),t)},this.LoadHttpDepends=function(e,t){var n=ProHttpDepends.paths;return loadDependsProxy(n,ProHttpDepends.promise,e,t)},this.LoadOcxDepends=function(e,t){var n=ProOcxDepends.paths;return loadDependsProxy(n,null,e,t)},this.loadDependsProxy=loadDependsProxy;var LoadModulesInfo={data:ModuleDepends.paths,iLoadIndex:0,tag:null,userData:null};function LoadModuleByModeleInfo(e,t,n){if(0==LoadModulesInfo.iLoadIndex&&(LoadModulesInfo.tag=t,LoadModulesInfo.userData=n),LoadModulesInfo.iLoadIndex<LoadModulesInfo.data.length){var o=LoadModulesInfo.data[LoadModulesInfo.iLoadIndex++];moduleInjectUtil(LoadModuleByModeleInfo,null,o[0],o.length>1?o[1]:null)}else LoadModulesInfo.iLoadIndex=0,LoadModulesInfo.tag&&LoadModulesInfo.tag(LoadModulesInfo.userData)}function moduleInjectUtil(e,t,n,o,i){if(i)return(t?e.bind(t):e)(),s;var s=GetRegedModule(n,"modules/"+(o||"")+n+".js",t?e.bind(t):e);return s}this.cmdParseInJect=function(e,t){return moduleInjectUtil(e,t,"CmdParse")},this.HandleResponseInJect=function(e,t){return moduleInjectUtil(e,t,"HandleResponse")},this.GetEmotionSync=function(){return SyncGetModule("ImEmotion")};var _jSWHostSaved=null;this.jSWGetHost=function(){if(_jSWHostSaved)return _jSWHostSaved;var e=document.getElementsByTagName("script"),t=null;for(var n in e)if(e[n].src.indexOf("jsw.js")>=0){t=e[n];break}return t?_jSWHostSaved=t.src.split("jsw.js")[0]:(console.error("you can not modify the name of jsw.js, please check"),"")},ModuleInfo.prototype={dependencyRelativePath:"jswlib/",proJswPath:null,setProJswPath:function(e){this.proJswPath=e},GetAbsPath:function(){if(null==this.szNames){this.szNames=[];for(var e="",t=0;t<this.names.length;t++)this.checkAllPromise(t)||(e=this.proJswPath+this.dependencyRelativePath+this.names[t],this.szNames.push(e))}return this.szNames},checkAllPromise:function(iIndex){var proExp="((typeof (pl) != 'undefined'))";return!!this.promise&&(proExp=this.promise instanceof Array?proExp.replace("pl",this.promise[iIndex]):proExp.replace("pl",this.promise),eval(proExp))}},ModuleInfo.prototype.setProJswPath(this.jSWGetHost()),this.RegModule=RegModule,this.CreateModule=function(e){var t={};return this.RegModule(e,t,!0),t},this.ClaimModule=function(e){var t=this.GetModule(e);return null==t&&(t=this.CreateModule(e),SetModuleReged(e,!1),console.log("[D] Claim Module: "+e)),t},this.RegClaimedModuleProxy=function(e,t){var n=this.GetModule(e);null==n&&(n=this.ClaimModule(e)),!CheckModuleReged(e)&&t&&(t(n),SetModuleReged(e,!0)),ConsoleLogRegModel(e)},this.RegClaimedModule=function(e,t){var n=this.GetModule(e);null==n&&(n=this.ClaimModule(e)),t&&(t.bind(n)(),n.__proto__=t.prototype),SetModuleReged(e,!0),ConsoleLogRegModel(e)},this.GetModule=function(e){return GetModuleEntiey("",e)}};jSW.jswGetDependUrl=DependencyMgr.jswGetDependUrl,jSW.DependencyMgr=DependencyMgr,module.exports={jSW:jSW,dMgr:DependencyMgr}},function(e,t){e.exports={ProModules:{paths:["thlib/jquery-1.8.2.min.js","bv.js","utils/Base64.js","utils/BigInt.js","utils/jn_rsa.js"],names:["jQuery","proto","Base64","biFromNumber","jnRSA"]},ProHttpDepends:{paths:["thlib/video.min.js","thlib/videojs-contrib-hls.min.js","thlib/videojs.zoomrotate.js","thlib/video-js.min.css","thlib/HttpFlv/codec/libffmpeg_265.js","thlib/HttpFlv/render/webgl.js","thlib/HttpFlv/flv.min.js","thlib/pcm/pcm-player.min.js"],promise:["videojs","videojshls","videojszoomrotate","videojs","Module","WebGLPlayer","flvjs","PCMPlayer"]},ProOcxDepends:{paths:["thlib/jquery-playbar.js","thlib/barstyle.css"]},ModuleDepends:{paths:[["jSWProtocol"],["jSWUtils"],["jswConst"],["CmdParse"],["ImEmotion"],["HandleResponse"],["Conference","Conference/"],["ImModule"],["HttpFlv"],["Audio","Audio/"],["AudioCapture","Audio/"],["AudioMgr","Audio/"],["HandleConfSpeak","Conference/"],["PuLoad"],["HTTPNruFile"]]}}},function(e,t,n){var o=n(0),i=o.jSW,s=o.jSWProtocol,r=o.jSWUtils,a=o.jSWOptions,l=o.PuLoad;o.AudioMgr,o.HTTPNruFile;i.CallProtoType={AUTO:0,OCX:1,HTTP:2,CheckOcx:function(e){return e==this.OCX}},i.OpenDebug=function(e){r._IsDebug=e},i._swOcxOnEvent=function(e,t){console.log("ocx on event rc:"+e+" websocket port: "+t);var n=parseInt(t);(e!=i.RcCode.RC_CODE_S_OK||n<=0)&&console.error("ocx init fail "+e+" "+n),n<=0&&(e=i.RcCode.RC_CODE_E_INVALIDARG),a.ocxWebsocketPort=n,a.init_options.oninit&&"function"==typeof a.init_options.oninit&&(r._mMgr.bUseOcx()?setTimeout(a.init_options.oninit,50,e):a.init_options.oninit(e))},i._swOcxPlayerOnEvent=function(e,t){try{0==e&&t&&t._swOnDivSizeChange(-1)}catch(e){}},i.GetHttpVersion=function(e){return setTimeout((function(){e.callback(e,{},{szversionid:i.version.ReqOcxVer})}),50),0},i.MessageType=null,i.RotateType=null,i.EventActions=null,i.swInit=function(e){return i.DependencyMgr.LoadProDepends((function(e){var t=function(e){var t={bocxws:!1,bNEGP:!1,bManualLP:!1};return e&&e.config&&(t.bocxws=!!e.config.bocxws,t.bNEGP=!!e.config.bNEGP,t.bManualLP=!!e.config.bManualLP),r._mMgr.setBUseOcxWs(t.bocxws),t}(e);console.log("Start Jsw Init"),function(e){return i.RcCode.bFaild(e)}(function(e){return 0=="WebSocket"in window?(alert("not support websocket"),e.oninit&&"function"==typeof e.oninit&&e.oninit(i.RcCode.RC_CODE_E_INVALIDARG),i.RcCode.RC_CODE_E_INVALIDARG):(a.calltype=e.calltype,i.CallProtoType.AUTO==a.calltype&&(r.isIE()?a.calltype=i.CallProtoType.OCX:a.calltype=i.CallProtoType.HTTP),0==r.isIE()&&i.CallProtoType.OCX==a.calltype?(console.error("only ie support ocx!"),e.oninit&&"function"==typeof e.oninit&&e.oninit(i.RcCode.RC_CODE_E_INVALIDARG),i.RcCode.RC_CODE_E_INVALIDARG):(a.init_options=e,i.RcCode.RC_CODE_S_OK))}(e=function(e){var t={url:null,calltype:i.CallProtoType.AUTO,oninit:null,home:null};return r.extend({},t,e||{})}(e)))||(null==i.MessageType&&(i.MessageType=s.RequestHeader.notifys),null==i.RotateType&&(i.RotateType=s.RotateType),null==i.EventActions&&(i.EventActions=s.EVENTACTIONS),function(e){var t=window.document.location.href,n=window.document.location.pathname,o=t.lastIndexOf(n),i=t.substring(0,o);null!=e.url&&e.url.length>0&&(i=e.url),null==e.home&&(e.home=i);var s=0==i.indexOf("https")?"https://":"http://";a.http=i,a.url=i.replace(s,"")+"/jswapi";var r=i.replace(s,"").split(":");a.ip=r[0],a.url.indexOf(":")>0?a.port=r[1]:a.port=-1}(e),i.CallProtoType.OCX==a.calltype?function(e){var t=document.getElementById("jsw_ocx");if(null==t){try{(t=document.createElement("object")).id="jsw_ocx",t.classid="clsid:51DF1D91-DA4E-47DA-A5BE-84A96ADD2425",t.width=1,t.height=1,t.style.position="absolute",t.style.top="0px",t.style.left="0px",document.body.appendChild(t)}catch(t){if(console.error("ocx attach exception "+t),(s=document.getElementById("jsw_ocx"))&&document.body.removeChild(s),i.CallProtoType.OCX==a.calltype)return e.oninit&&"function"==typeof e.oninit&&e.oninit(i.RcCode.RC_CODE_E_INVALIDARG),i.RcCode.RC_CODE_E_INVALIDARG;a.calltype=i.CallProtoType.HTTP}if(null!=t){try{var n=0,o=setInterval((function(){var e=t.oxGetWebSocketPort();e>0||n>20?(clearInterval(o),i._swOcxOnEvent(0,e)):n++}),500)}catch(t){var s;if((s=document.getElementById("jsw_ocx"))&&document.body.removeChild(s),document.body.removeChild(oScript),console.error("ocx add event exception "+t),i.CallProtoType.OCX==a.calltype)return e.oninit&&"function"==typeof e.oninit&&e.oninit(i.RcCode.RC_CODE_E_INVALIDARG),i.RcCode.RC_CODE_E_INVALIDARG;a.calltype=i.CallProtoType.HTTP}r._mMgr.RegOcxHandle(t)}}else e.oninit&&"function"==typeof e.oninit&&e.oninit(i.RcCode.RC_CODE_S_OK);i.DependencyMgr.LoadOcxDepends()}(e):a.calltype==i.CallProtoType.HTTP&&function(e){i.DependencyMgr.LoadHttpDepends((function(e){e.oninit&&"function"==typeof e.oninit&&(e.oninit(i.RcCode.RC_CODE_S_OK),r.debugLogInfo("load video.js ok!"))}),e)}(e),l.PuLoadInit(t))}),e),0},i.swDeInit=function(){if(a.session_list&&a.session_list.length>0){for(var e=0;e<a.session_list.length;e++)a.session_list[e].swDispose(),delete a.session_list[e];a.session_list=[]}if(i.RcCode)return i.RcCode.RC_CODE_S_OK},i.swGetOption=function(){return{http:a.http,version:a.version,calltype:a.calltype}}},function(t,n,o){var i=o(0),s=i.jSW,r=i.jSWProtocol,a=i.jSWUtils,l=i.jSWOptions,u=i.PuLoad,c=(i.AudioMgr,i.HTTPNruFile);s.SWSession=function(e){s.swDeInit();e=a.extend({},{server:"127.0.0.1",port:9701,onopen:null,onclose:null},e||{}),s.SWSession._init(this,e),s.SWSession._CreateWs(this,e)},s.SWSession._GetSessionById=function(e){},s.SWSession._init=function(e,t){e._server=l.ip!=t.server||a.isIE()?t.server:"127.0.0.1",e._port=Number(t.port),e._arr_pu=[],e._arr_pu_index=[],e._arr_pu_offline=[],e._arr_pu_online=[],e._arr_dialog=[],e._arr_record_play=[],e._p_emms=new proto.WEBBVCU.EmmsHeader,e._p_emms.setKey(l.appkey),e._p_emms.setVer(l.version),e._emms=new r.EmmsHeader(l.appkey,l.version),e._bLogout=!1,e._callbackManager=new s.SWCallbackManager(e,[r.RequestHeader.notifys.notify.cmd,r.RequestHeader.login.cmd,r.RequestHeader.keeplive.cmd,r.RequestHeader.logout.cmd,r.RequestHeader.pulist.cmd,r.RequestHeader.openchanle.cmd,r.RequestHeader.keeplivechanle.cmd,r.RequestHeader.closechanle.cmd,r.RequestHeader.pugpsdata.cmd,r.RequestHeader.lossconnection.cmd,r.RequestHeader.pugroup.cmd]),e._pusModule=new s.SWSession._SwPuModule(e),e._confManager=new s.SwConfManager(e),e._immodule=new s.SWSession.SwImModule(e,e._confManager,e._pusModule),e._userManager=new s.SwUserManager(e),e._commDlgMgr=new s.CommonDlgMgr(e)},s.SWSession._CreateWs=function(e,t){try{a._mMgr.loadWebSocket((function(e,t,n){try{var o=r.GetWsUrl();e._ws=new n(o),e._checkWsCreateResult(t)}catch(n){e._onWsError(t,n)}}),e,t)}catch(e){return void this._onWsError(t,e)}},s.SWSession._SwPuModule=function(e){this._session=e},s.SWSession._SwPuModule.prototype={_onNotifyImMsg:function(e,t){var n=r.RequestHeader.confnotify.notifyimmsg.cmd,o={szSourceId:e.szSourceId,iSourceId:e.iSourceId};data={sender:o,szmsgs:e.szmsg},this._notifytouser(t,n,data)},_notifytouser:function(e,t,n){this._session._callbackManager.dispatchCallback("notify",{code:e.getCode(),response:e,msg:t,content:n})}},s.SWSession.prototype={swGetOnlineUsers:function(e){return r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_ONLINE,callback:e.callback,tag:e.tag})},swGetOnlineUsersClassified:function(e){return r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_ONLINE,callback:function(t,n,o){var i=null;n.emms.code==s.RcCode.RC_CODE_S_OK&&((i={userlist:null,pulist:null}).userlist=o.filter((function(e){return 0==e.devid.indexOf("UA_")})),i.pulist=o.filter((function(e){return 0==e.devid.indexOf("PU_")&&0==i.userlist.some((function(t){var n=!1;try{n=e.devid.split("_")[1]==t.devid.split("_")[1]}catch(e){console.error(e)}return n}))})),i.userlist=o.filter((function(e){return 0==e.devid.indexOf("UA_")||0==e.devid.indexOf("CU_")})));var a=r.BuildEventOptions(null,null,null,e.tag);e.callback(a,n,i)},tag:e.tag})},_OnOpenGpsChannel:function(e,t,n,o){var i=this.swGetPu(e);if(i){var s=i.swGetChanel(t);s&&s._OnOpenGpsHasResult(n,o)}},_OnNotifyGpsData:function(e,t,n){var o=this.swGetPu(e);if(o){var i=o.swGetChanel(t);i&&i._tickGpsData(n)}},_checkWsCreateResult:function(t){if(null==this._ws)return console.error("http websoket error null"),void this._onWsError(t,e);this._onWsCreateOk(t),a._mMgr.oWsOpen(this._ws)},_onServerDisconnect:function(){this._releaseActiveChannel(),this._callbackManager.dispatchCallback(r.RequestHeader.lossconnection.cmd,{code:0,response:{},msg:r.RequestHeader.lossconnection.cmd,content:null})},_onWsCreateOk:function(e){-1==l.session_list.indexOf(this)&&l.session_list.push(this);var t=this,n=e;console.log("websoket connect ..."),this._ws.onopen=function(){console.log("http websoket connect success!"),n.onopen&&"function"==typeof n.onopen&&n.onopen(t)},this._ws.onerror=function(e){t._ws=null,t._onWsError(n,e)},this._ws.onmessage=function(e){r.txOnResponse(-1,e.data)},this._ws.onclose=function(e){t._ws=null,console.log("http websoket connect closed:"+e.code+" reason: "+e.reason),this._doReconnect((function(){t.swLogout()})),n.onclose&&"function"==typeof n.onclose&&n.onclose(t,e)},this._ws._doReconnect=function(e){if(0==t._bLogout)if(t._emms.session.length>0){console.log("session stay login");var n=this._time_last_check();n>0?(console.log("test then should reconnect"),this._doReconnectTimerAction(t,n,(function(e){e._statusReset()}))):(console.log("try login spend too much time, endpoint of server maybe released. stop reconnecting and notify caller"),this._statusReset(),e())}else console.log("session did not login, should not reconnect");else console.log("session has logout, should not reconnect"),this._statusReset()},this._ws._time_last_check=function(){var e=t._serverConfig.sessionidletime/1e3;return void 0===n._reConnectTimes?e+1:e-(Date.parse(new Date)/1e3-n._reConnectTimes)},this._ws._statusReset=function(){n._reConnectTimes=-1,n._extendTag&&(n=n._extendTag)},this._ws._doReconnectTimerAction=function(e,t,o){console.log("timer ticked, try to reconnect"),n&&void 0===n._bReConnect&&(n={_reConnectTimes:-1,_bReConnect:!0,_extendTag:n,onopen:function(t){console.log("connected to ws server, reset connect times"),o(e._ws),r.SendRequest({session:t,msgtype:proto.WEBBVCU.MSGType.WEB_REREG_WEBSOCKET_COMMAND})}}),-1==n._reConnectTimes&&(n._reConnectTimes=Date.parse(new Date)/1e3),setTimeout((function(e){s.SWSession._CreateWs(e,n)}),1e3,e),console.log("timer reconnect action "+t)},this._ws._doCheckBReconnect=function(){return!(!n||!n._bReConnect)}},_onWsError:function(e,t){console.error("http websoket error"+t),e.onclose&&"function"==typeof e.onclose&&e.onclose(this,t)},swSetGlobalControlParam:function(e){var t=s.RcCode.RC_CODE_E_UNSUPPORTED;if(l.CheckOcx()){if(null==typeof e.Idelayvssmooth)return s.RcCode.RC_CODE_E_INVALIDARG;var n=new proto.WEBBVCU.ParamsDialogControl;return n.setIdelayvssmooth(e.Idelayvssmooth),t=r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_GLOBAL_DIALOG_PARAM,payload:n,callback:e.callback,tag:e.tag})}return t},swImSend:function(e){if(e.msgitems);else{if(!e.filepath)return s.RcCode.RC_CODE_E_BVCU_INVALIDARG;if(!e.targetid||-1==e.targetid.indexOf("PU"))return console.log("target id invalidarg"),s.RcCode.RC_CODE_E_BVCU_INVALIDARG;e.msgitems=[{nruid:"NRU_",iType:r.IMMSGTypes.FILE,data:e.filepath}]}return void 0===e.iapplierid&&(e.iapplierid=0),this._immodule._swConfIMSend(e,proto.WEBBVCU.MSGType.WEB_BVCU_CONF_IM_MSG)},swImRecv:function(e){return e.targetid&&-1!=e.targetid.indexOf("PU")?(e.msgitems=[{nruid:e.nruid,iType:r.IMMSGTypes.FILE,data:e.remotepath}],this._immodule._SwConfFileRecv(e)):(console.log("target id invalidarg"),s.RcCode.RC_CODE_E_BVCU_INVALIDARG)},swOpenFileInDir:function(e){if(l.calltype!=s.CallProtoType.OCX)return s.RcCode.RC_CODE_E_BVCU_UNSUPPORTED;if(s.CallProtoType.OCX!=l.calltype)return s.RcCode.RC_CODE_E_FAIL;var t=e.szFilePath;return r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_UTILS_OPEN_FILE_IN_DIR,payload:t,callback:e.callback,tag:e.tag})},_send:function(e){var t=this._ws;if(null==t)return console.error("websocket is null, current calltype "+(l.CheckOcx()?"ocx":"http")),s.RcCode.RC_CODE_E_DISCONNECTED;if(this._ws.OPEN||(this._ws.OPEN=1),t.readyState!=this._ws.OPEN)return console.warn("websocket not connection"),s.RcCode.RC_CODE_E_DISCONNECTED;if(this._bLogout)return s.RcCode.RC_CODE_E_BVCU_DISCONNECTED;try{return t.send(e),s.RcCode.RC_CODE_S_OK}catch(e){return s.RcCode.RC_CODE_E_DISCONNECTED}},swAddCallBack:function(e,t){return this._callbackManager.addCallback(e,t),s.RcCode.RC_CODE_S_OK},swGetVersion:function(e){if(l.CheckHttp())return setTimeout((function(){e.callback(e,{},{szprototype:"HTTP",szversionid:s.version.SdkVer})}),50),n;var t=new proto.WEBBVCU.Request;t.setMsgtype(proto.WEBBVCU.MSGType.WEB_GET_VERSION_INFO),t.setEmms(this._p_emms);var n=r._internalSend({session:this,request:t,callback:e.callback,enforce:!0});return n},swLogin:function(e){e=a.extend({},{user:"admin",password:"123456"},e||{}),this._user=e.user;var t=new proto.WEBBVCU.Request;return t.setMsgtype(proto.WEBBVCU.MSGType.WEB_BVCU_GET_PUBKEY),t.setEmms(this._p_emms),r._internalSend({cmd:r.RequestHeader.pubkey.cmd,session:this,request:t,callback:function(t,n){t.tag,n.url;var o=t.request;if((l=t.session).p_options=t,l.p_response=n,n.getCode()==s.RcCode.RC_CODE_S_OK){var i=n.getPayload(),a=proto.WEBBVCU.PublicKey.deserializeBinary(i);this.pubkey_d=a.getD(),this.pubkey_n=a.getN();var l=t.session;(o=new proto.WEBBVCU.Request).setMsgtype(proto.WEBBVCU.MSGType.WEB_BVCU_LOGIN),o.setEmms(l._p_emms);var u=new proto.WEBBVCU.BVCU_LOGIN;u.setServer(l._server),u.setPort(Number(l._port)),u.setUser(l._user),u.setPassword(e.password),o.setPayload(u.serializeBinary()),r._internalSend({cmd:r.RequestHeader.login.cmd,session:l,request:o}),console.log("login info:"+l._server+":"+l._port+"user"+l._user)}}})},swLogout:function(){this._releaseActiveChannel(),this._arr_pu_index=[],this._arr_pu.splice(0,this._arr_pu.length),this._arr_dialog.splice(0,this._arr_dialog.length),this._timer_keeplive&&(clearInterval(this._timer_keeplive),this._timer_keeplive=null);var e=new r.JsonParamNoAttach(this._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_LOGOUT),t=r._internalSend({cmd:r.RequestHeader.logout.cmd,session:this,request:e}),n=l.session_list,o=0;for(o=0;o<n.length;o++)if(n[o]==this){l.session_list.splice(o,1),this._bLogout=!0;break}return null!=this._confManager&&(this._confManager._clear(),this._confManager=null),this._confManager=null,this._immodule=null,this._pusModule=null,this._commDlgMgr=null,this._userManager._clear(),this._userManager=null,this._arr_pu=null,this._arr_pu_index=null,this._arr_pu_offline=null,this._arr_pu_online=null,this._arr_dialog=[],this._arr_record_play=[],this._p_emms=null,this._emms=null,this._serverConfig=null,this.p_options=null,this.p_response=null,this.swDispose(),t},_releaseActiveChannel:function(){for(var e=0;e<this._arr_dialog.length;e++)this._arr_dialog[e].swClose();for(e=0;e<this._arr_pu.length;e++)this._arr_pu[e]._clear()},swKeepLive:function(){r.RequestHeader.keeplive;var e=new r.JsonParamNoAttach(this._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_KEEPALIVE),t=r._internalSend({cmd:r.RequestHeader.keeplive.cmd,session:this,request:e});return console.log("keeplive session: "+this._server+" "+this._port),t},swGetPuList:function(e){return this._AutoReqSendProxy(e,{status:3,pagesize:0,page:0},(function(e){var t=r.ParamPuList(e.status,e.pagesize,e.page);return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SEARCH_GET_PULIST,target:"CMS_",payload:t,cmd:r.RequestHeader.pulist.cmd}}))},swSearchPuList:function(e){return u.SearchGetPulist(e,e.callback,e.tag)},_swAsyncGetPu:function(e){if(!e.szpuid||0==e.szpuid.length)return s.RcCode.RC_CODE_E_INVALIDARG;var t=this._AutoReqSendProxy(e,{},(function(e){return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_PUINFO_BY_PUID,target:e.szpuid}}));return console.log("async get pu list"),t},_AutoReqSendProxy:function(e,t,n){t||(t={}),e||(e={});s.RcCode.RC_CODE_E_FAIL;var o={session:this,msgtype:-1,target:"",targetIndex:-1,payload:null,cmd:"",callback:(e=a.extend({},t,e||{})).callback?e.callback:null,tag:e.tag?e.tag:null},i=n.bind(this)(e);return i=a.extend({},o,i||{}),r.SendRequest(i)},swSearch:function(e){return this._searchFile(e,"NRU_")},swDownFileFromNru:function(e){return e=a.extend({},{pcallback:null},e||{}),this._swDownFileSearch({szRFP:e.remoteFilePath,szLFD:e.localFileDir,szTargetId:e.szNRUID,msgType:proto.WEBBVCU.MSGType.WEB_BVCU_DOWN_FILE_ONNRU,callback:e.callback,callbackrelay:e.pcallback,tag:e.tag})},_searchFile:function(e,t){var n={stSearchInfo:{iType:1,iPostition:0,iCount:50},stFilter:{szPUID:"",iChannelIndex:-1,iFileType:0,iTimeCondition:0,iTimeBegin:0,iTimeEnd:0,iFileSizeMin:0,iFileSizeMax:0,iRecordType:0,szDesc1:"",szDesc2:""},callback:null,tag:null};(e=a.extend({},n,e||{})).stSearchInfo=a.extend({},n.stSearchInfo,e.stSearchInfo||{}),e.stFilter=a.extend({},n.stFilter,e.stFilter||{});var o=r.ParamSearchList(e.stSearchInfo,e.stFilter);return r.SendRequest({cmd:r.RequestHeader.searchlist.cmd,session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_SEARCH_LIST,target:t,payload:o,callback:e.callback,tag:e.tag})},swDelRecordFileFilter:function(e){var t={stFilter:{szPUID:"",iChannelIndex:-1,iFileType:0,iTimeCondition:0,iTimeBegin:0,iTimeEnd:0,iFileSizeMin:0,iFileSizeMax:0,iRecordType:0,szDesc1:"",szDesc2:""},callback:null,tag:null};(e=a.extend({},t,e||{})).stFilter=a.extend({},t.stFilter,e.stFilter||{});var n,o,i,s=(n=e.stFilter,o=new proto.BVCU.NRUConfig.DeleteFileReq,(i=new proto.BVCU.Search.Search_FileFilter).setSzpuid(n.szPUID),i.setIchannelindex(n.iChannelindex),i.setIfiletype(n.iFileType),i.setItimebegin(n.iTimeBegin),i.setItimeend(n.iTimeEnd),i.setIfilesizemin(n.iFileSizeMin),i.setIfilesizemax(n.iFileSizeMax),i.setIrecordtype(n.iRecordType),i.setSzdesc1(n.szDesc1),i.setSzdesc2(n.szDesc2),i.setItimecondition(n.iTimeCondition),o.setItype(1),o.setIcount(1),o.addStfilefilters(i),o);return r.SendRequest({cmd:r.RequestHeader.recordfile_del.cmd,session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_RECORDFILE_DELETE,payload:s,callback:e.callback,tag:e.tag})},swDelRecordFileFilterId:function(e){(e=a.extend({},{stFileIds:[],callback:null,tag:null},e||{})).stFileIds||(e.stFileIds=[]);var t=function(e){var t=new proto.BVCU.NRUConfig.DeleteFileReq;t.setItype(2);for(var n=0;n<e.length;n++){var o=new proto.BVCU.NRUConfig.FileID;o.setSzsourceid(e[n].nruid),o.addIrecordid(e[n].recordid),t.addStfileidfilters(o)}return t}(e.stFileIds);return r.SendRequest({cmd:r.RequestHeader.recordfile_del.cmd,session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_RECORDFILE_DELETE,payload:t,callback:e.callback,tag:e.tag})},swSearchFileOnPu:function(e){return null==e||null==e.stFilter||null==e.stFilter.szPUID||0==e.stFilter.szPUID.length?(console.warn("bad args, please check!"),s.RcCode.RC_CODE_E_FAIL):this._searchFile(e,e.stFilter.szPUID)},swDownFileFromPu:function(e){return e=a.extend({},{pcallback:null},e||{}),this._swDownFileSearch({szRFP:e.remoteFilePath,szLFD:e.localFileDir,szTargetId:e.szPUID,msgType:proto.WEBBVCU.MSGType.WEB_BVCU_DOWN_FILE_ONPU,callback:e.callback,callbackrelay:e.pcallback,tag:e.tag})},_swDownFileSearch:function(e){var t=s.RcCode.RC_CODE_E_FAIL;if(l.CheckNotOcx())t=c.DownloadToLocal(e.szTargetId,e.szRFP),e.callback&&e.callback({tag:e.tag},{emms:{code:t}});else{if(l.calltype!=s.CallProtoType.OCX)return alert("Just OCX support!!"),s.RcCode.RC_CODE_E_FAIL;if(null==e||null==e.szTargetId||0==e.szTargetId.length||null==e.szRFP||0==e.szRFP.length||null==e.szLFD||0==e.szLFD.length)return console.warn("bad args, please check!"),s.RcCode.RC_CODE_E_FAIL;var n=new proto.WEBBVCU.DownFileFromPu,o=e.szRFP;0==e.szTargetId.indexOf("NRU")&&(o=e.szRFP.replace(/\//g,"\\")),n.setSzremotefilepathname(o),n.setSzlocalfilepathname(e.szLFD),t=r.SendRequest({session:this,msgtype:e.msgType,target:e.szTargetId,payload:n,callback:e.callback,callbackrelay:e.callbackrelay,tag:e.tag})}return t},swSearchGpsV2:function(e){var t=new r.BVCU_Search_FileFilter(e.szPuid,-1,e.iTimeBegin,e.iTimeEnd,4,0,0,0);return this.swSearch({stSearchInfo:e.stSearchInfo,stFilter:t,callback:e.callback,tag:e.tag})},swGetGpsRecordDataV2:function(e){return this._swGetGpsRecordData(e,proto.WEBBVCU.MSGType.WEB_BVCU_DOWNLOAD_GPS_RECORD_SERVERC)},swSearchGps:function(e){if(l.calltype!=s.CallProtoType.OCX)return alert("Just OCX support!!"),s.RcCode.RC_CODE_E_FAIL;if(null==e.szNruId||0==e.szNruId.length)return console.warn("nruid should be invalid!"),s.RcCode.RC_CODE_E_FAIL;if(null==e.iTimeBegin||null==e.iTimeEnd)return console.warn("time slice should be invalid!"),s.RcCode.RC_CODE_E_FAIL;if(null==this._swGetPu(e.szPuid)||null==e.szPuid||0==e.szPuid.length)return console.warn("puid should be invalid!"),s.RcCode.RC_CODE_E_FAIL;if(e.iTimeBegin=Number(e.iTimeBegin),e.iTimeEnd=Number(e.iTimeEnd),e.iTimeBegin>=e.iTimeEnd)return console.warn("time slice should be invalid!"),s.RcCode.RC_CODE_E_FAIL;var t=new proto.WEBBVCU.RecordFileFilter;return t.setSzpuid(e.szPuid),t.setItimebegin(e.iTimeBegin),t.setItimeend(e.iTimeEnd),r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_GPS_RECORD,target:e.szNruId,payload:t,callback:e.callback,tag:e.tag})},swGetGpsRecordData:function(e){return this._swGetGpsRecordData(e,proto.WEBBVCU.MSGType.WEB_BVCU_DOWNLOAD_GPS_RECORD,!0)},_swGetGpsRecordData:function(e,t,n){if(n&&l.CheckNotOcx())return alert("Just OCX support!!"),s.RcCode.RC_CODE_E_FAIL;if(null==e.szNruId||0==e.szNruId.length)return console.warn("nruid should be invalid!"),s.RcCode.RC_CODE_E_FAIL;if(null==e.szFilePath||0==e.szFilePath.length)return console.warn("file path should be invalid!"),s.RcCode.RC_CODE_E_FAIL;var o;if(l.CheckNotOcx())c.Download(e.szNruId,e.szFilePath,0,(function(t,n,o){var i=[];if(200==t){var a=(new DOMParser).parseFromString(r.LargeHexToString(n),"application/xml");console.log(a);for(var l=null,u=null,c=a.children[0].children,_=null,d=0;d<c.length;d++)if(l={},1!=(u=c[d]).attributes.length){for(var p=0;p<u.attributes.length;p++)_=Number(u.attributes[p].nodeValue),Number.isNaN(_)?l[u.attributes[p].nodeName]=u.attributes[p].nodeValue:l[u.attributes[p].nodeName]=_;l.long=l.lng,i.push(l)}}if(e.callback){var h=200==t?s.RcCode.RC_CODE_S_OK:s.RcCode.RC_CODE_E_FAIL;e.callback({tag:e.tag},{emms:{code:h}},{fileinfo:{},gpsdata:{szgpspoint:i},data:i})}}),null);else{var i=new proto.WEBBVCU.FTPFileInfo,u=e.szFilePath.replace(/\//g,"\\");i.setSzfilepath(a.string2Uint8Array(u)),o=r.SendRequest({session:this,msgtype:t,target:e.szNruId,payload:i,callback:e.callback,tag:e.tag})}return o},swGetNruList:function(e){return r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_NRU_LIST,callback:e.callback,tag:e.tag})},swGetRecordPlayer:function(e){for(var t=0;t<this._arr_record_play.length;t++)if(player=this._arr_record_play[t],player&&player._dialog_id==e)return player;return console.log("swGetRecordPlayer not found, dialogId: "+e),null},_swGetRecordPlayer:function(e){for(var t=0;t<this._arr_record_play.length;t++)if(player=this._arr_record_play[t],player&&player._player_id==e)return player;return console.log("_swGetRecordPlayer not found, playerId: "+e),null},_swDelRecordPlayer:function(e){for(var t=0;t<this._arr_record_play.length;t++)if(player=this._arr_record_play[t],player&&player._dialog_id==e)return this._arr_record_play[t]=null,!0;return!1},swRecordPlayCtrl:function(e){e=a.extend({},{cmdtype:"PLAY",dialogId:0,ntp_begin:-1,ntp_end:-1,scale:-1,callback:null,tag:null},e||{});var t=new proto.WEBBVCU.MSG_WEB_BVCU_RECORD_PLAY_CRTL;return t.setCmdtype(e.cmdtype),t.setDialogid(e.dialogId),t.setNtpBegin(e.ntp_begin),t.setNtpEnd(e.ntp_end),t.setScale(e.scale),r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_RECORD_PLAY_CRTL,cmd:r.RequestHeader.recordplay.play.cmd,target:e.dialogId,payload:t,callback:e.callback,tag:e.tag})},swRecordPlay:function(e){if(l.calltype!=s.CallProtoType.OCX)return alert("Just support ocx Video!!"),s.RcCode.RC_CODE_E_BVCU_BADSTATE;if(null==(e=a.extend({},{url:null,nru:null,video:!0,audio:!0,callback:null,div:null,time_begin:-1,time_end:-1,bWindowless:!1},e||{})).url||0==e.url.length)return console.error("url error: "+e.url),s.RcCode.RC_CODE_E_INVALIDARG;var t=null;"string"==typeof e.div&&(e.div=document.getElementById(e.div));var n=e.div;if(null==n)return console.error("no have div"),s.RcCode.RC_CODE_E_INVALIDARG;void 0===n.bv_uuid&&(n.bv_uuid=a.generateUUID());var o=null,i=n.bv_uuid+"_0077554",u=i+"tempdiv";if(null==(o=document.getElementById(i))){var c=document.getElementById(u),_=null;null==c&&((c=document.createElement("div")).id=i+"tempdiv",c.style.width="100%",c.style.height="calc(100% - 20px)",(_=document.createElement("div")).id=i+"tempdiv_playbar",_.style.width="100%",_.style.backgroundColor="#555",c.databardiv=_),c.style.display="block",_=c.databardiv,n.appendChild(c),n.appendChild(_),(t=new jQuery.TigerPlayer).addBar($("#"+_.id),6e4,(function(e){e.swPlay()}),(function(e){e.swPause()}),(function(e){e.swClose()}),(function(e,t){e.swJump({ntp_begin:t})})),(o=s.SWVideoChanel._Ocx_PlayObjMgr.GetPlayObj(e.bWindowless)).tag=this,o.id=i,c.appendChild(o),isNeedDelay=!0;var d=i+"script_handler",p=document.getElementById(d);null==p&&((p=document.createElement("script")).id=d,p.type="text/javascript",p.setAttribute("for",i),p.setAttribute("event","OnHwndEvent(hwnd, ieventtype, pParam)"),p.text="jSW._swOcxPlayerOnEvent(ieventtype, this.tag);",document.body.appendChild(p),n.bv_playBackOScriptId=d,n.playObjectId=i),o.data_player_bar=t}else t=o.data_player_bar,console.warn("have element : "+i);var h=this;return setTimeout((function(){!function(e,t,n,o,i){var l=a.generateUUID(),u=new proto.WEBBVCU.MSG_WEB_BVCU_RECORD_PLAY;if(u.setFilepath(t.url),u.setNruid(t.nru),u.setVideo(t.video?1:0),u.setAudio(t.audio?1:0),u.setBwindowless(t.bWindowless),u.setStarttime(0),u.setEndtime(-1),u.setHwnd(0),u.setAutoplay(0),u.setPlayerId(l),null!=n?(u.setHwnd(n.GetWMHwnd()),n.style.display="block"):console.error("p_playObject is null"),r.SendRequest({session:e,payload:u,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_RECORD_PLAY,callback:t.callback,tag:t.tag})==s.RcCode.RC_CODE_S_OK){var c=new s.SWPlayer(e,{playerId:l,nruId:t.nru,file:t.url,dialogId:-1,parentDiv:o,time_begin:t.time_begin,time_end:t.time_end,bar:i,callback:t.closecallback,tag:t.closetag});e._arr_record_play.push(c)}}(h,e,o,n,t)}),500),s.RcCode.RC_CODE_S_OK},swVodVideo:function(e){if(l.calltype==s.CallProtoType.OCX)return alert("Just Http support Vod Video!!"),s.RcCode.RC_CODE_E_BVCU_BADSTATE;if(null==(e=a.extend({},{url:null,callback:null,tag:null},e||{})).url||0==e.url.length)return console.error("url error: "+e.url),s.RcCode.RC_CODE_E_INVALIDARG;var t=e.div;if("string"==typeof t&&(t=document.getElementById(t),console.log(typeof t)),null==t)return console.error("no have div"),s.RcCode.RC_CODE_E_INVALIDARG;void 0===t.bv_uuid&&(t.bv_uuid=a.generateUUID());var n=t.bv_uuid+"_0077553";return playObject=document.getElementById(n),null==playObject&&(playObject=document.createElement("VIDEO"),playObject.setAttribute("id",n),playObject.setAttribute("class","video-js vjs-default-skin vjs-big-play-centered"),playObject.style.width="100%",playObject.style.height="100%",playObject.style.display="block",playObject.src=e.url,t.appendChild(playObject)),e.callback&&setTimeout(e.callback,50,{tag:e.tag},{emms:{code:s.RcCode.RC_CODE_S_OK}}),s.RcCode.RC_CODE_S_OK},swVodVideoEx:function(e){return s.RcCode.RC_CODE_E_UNSUPPORTED},swGetConfManager:function(){return this._confManager},swGetUserManager:function(){return this._userManager},swGetPu:function(e){var t=this._swGetPu(e);return t||this._swAsyncGetPu({szpuid:e}),t},_swGetPu:function(e){var t=this._swGetPuFromArr(e,this._arr_pu);return-1==t?null:this._arr_pu[t]},_swGetPuFromArr:function(e,t){for(var n=0;n<t.length;n++)if(t[n]._id_pu==e)return n;return-1},_swCheckPuArr:function(e){var t=this._swGetPuFromArr(e._info_pu.id,this._arr_pu_offline),n=this._swGetPuFromArr(e._info_pu.id,this._arr_pu_online);0==e._info_pu.onlinestatus?(-1!=n&&this._arr_pu_online.splice(n,1),-1==t&&this._arr_pu_offline.push(e)):1==e._info_pu.onlinestatus&&(-1==n&&this._arr_pu_online.push(e),-1!=t&&this._arr_pu_offline.splice(t,1))},swGetPuChanel:function(e,t){var n=this._swGetPu(e);return n?n.swGetChanel(t):null},swGetPuDeviceInfo:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_DEVICEINFO,r.RequestHeader.pucfg.getpudeviceinfo.cmd,this,null)},swSetPuDeviceInfo:function(e){dft_poptions={ilanguage:1,name:"default name"},e=a.extend({},dft_poptions,e||{});var t=new proto.BVCU.PUConfig.DeviceInfo;return t.setSzid(e.puid),t.setIlanguageindex(e.ilanguage),t.setSzname(e.name),t.setIputype(0),r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_DEVICEINFO,cmd:r.RequestHeader.pucfg.getpudeviceinfo.cmd,target:e.puid,payload:t,callback:e.callback,tag:e.tag})},swGetPuDeviceTime:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_DEVICETIME,r.RequestHeader.pucfg.getpudevicetime.cmd,this,null)},swGetPuEthernet:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_ETHERNET,r.RequestHeader.pucfg.getpuethernet.cmd,this,null)},swGetPuRadioNetwork:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_RADIONETWORK,r.RequestHeader.pucfg.getpuradionetwork.cmd,this,null)},swGetPuWifi:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_WIFI,r.RequestHeader.pucfg.getpuwifi.cmd,this,null)},swGetPuPower:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_POWER,r.RequestHeader.pucfg.getPuPower.cmd,this,null)},swGetPuOnlineControl:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_ONLINECONTROL,r.RequestHeader.pucfg.getPuOnlineControl.cmd,this,null)},swGetPuUpdateStatus:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_UPDATESTATUS,r.RequestHeader.pucfg.getPuUpdateStatus.cmd,this,null)},swGetPuLinkactionList:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_LINKACTION_LIST,r.RequestHeader.pucfg.getPuLinkactionList.cmd,this,null)},swGetLinkActionInfo:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_LINKACTION_LIST,r.RequestHeader.pucfg.getPuLinkactionList.cmd,this,e.linkactionbaseinfo)},swGetPuCarInfo:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_CARINFO,r.RequestHeader.pucfg.getPuCarInfo.cmd,this,null)},swGetPuZfyInfo:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_ZFYINFO,r.RequestHeader.pucfg.getPuZfyInfo.cmd,this,null)},swSetPuZfyInfo:function(e){dft_poptions={serial:"default",userno:"default",userame:"default",description:"default",unitno:"default",unitname:"default",defaultconference:""},e=a.extend({},dft_poptions,e||{});var t=new proto.BVCU.PUConfig.ZFYInfo;return t.setSzserial(e.serial),t.setSzuserno(e.userno),t.setSzusername(e.userame),t.setSzuserdescribe(e.description),t.setSzunitno(e.unitno),t.setSzunitname(e.unitname),t.setSzdefaultconference(e.defaultconference),r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_ZFYINFO,cmd:r.RequestHeader.pucfg.setPuZfyInfo.cmd,target:e.puid,payload:t,callback:e.callback,tag:e.tag})},swGetPuServers:function(e){return this._swGetPuOperation(e,proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_SERVERS,r.RequestHeader.pucfg.getPuServers.cmd,this,null)},_swGetPuOperation:function(e,t,n,o,i){var s=r.JsonParamCommand(this._p_emms,t,r.BVCU_Command(e.puid,-1,i));return r._internalSend({cmd:n,session:o,request:s,callback:e.callback,tag:e.tag})},swLogQuery:function(e){return s.DependencyMgr.cmdParseInJect((function(){this._swLogQuery(e)}),this)},_swLogQuery:function(e){e=a.extend({},{ipostition:0,icount:120,itimebegin:0,itimeend:0,username:"",targetid:"",itargetindex:-1,callback:null,tag:null},e||{});var t=new proto.BVCU.Search.Search_Request,n=new proto.BVCU.Search.SearchInfo;t.setStsearchinfo(n),n.setItype(r.SearchType.OPERATE),n.setIcount(Number(e.icount)),n.setIpostition(Number(e.ipostition));var o=new proto.BVCU.Search.Search_OperateLog;if(t.setStoperatefilter(o),o.setSzusername(e.username),o.setSztargetid(e.targetid),0!=e.itimebegin&&0!=e.itimeend&&e.itimeend<e.itimebegin)return console.error("get operate log utc time error please check!"),s.RcCode.RC_CODE_E_FAIL;o.setIoperatetime(e.itimebegin),o.setItimeend(e.itimeend);var i=Number(e.itargetindex);return null!=i&&i>=0&&o.setItargetindex(i),o.serializeBinary(),r.SendRequest({session:this,targetIndex:i,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_SEARCH_OPERATE,payload:t,callback:e.callback,tag:e.tag})},swGetHistoryIM:function(e){var t=new proto.BVCU.Search.Search_Request,n=new proto.BVCU.Search.SearchInfo,o=new proto.BVCU.Search.Search_IMMsgFilter;if(void 0===e.stSearchInfo)return s.RcCode.RC_CODE_E_INVALIDARG;var i=e.stSearchInfo;if(n.setIcount(Number(i.iCount)),n.setIpostition(Number(i.iPostition)),n.setItype(9),void 0===e.stFilter)return s.RcCode.RC_CODE_E_INVALIDARG;var a=e.stFilter;return void 0!==a.senderDevId&&o.setSzsenddevid(a.senderDevId),void 0!==a.senderUserId&&o.setSzsenduserid(a.senderUserId),void 0!==a.confId&&o.setSzconfid(a.confId),void 0!==a.recvDevId&&o.setSzrecvdevid(a.recvDevId),void 0!==a.recvUserId&&o.setSzrecvuserid(a.recvUserId),void 0!==a.szCallID&&o.setSzcallid(a.szCallID),void 0!==a.iStartTime&&o.setIstarttime(Number(a.iStartTime)),void 0!==a.iEndTime&&o.setIendtime(Number(a.iEndTime)),void 0!==a.iHasBeenRecv&&(-1==a.iHasBeenRecv?o.setIhasbeenrecv(Math.pow(2,32)-1):o.setIhasbeenrecv(a.iHasBeenRecv)),void 0!==a.iMsgType&&o.setImsgtype(Number(a.iMsgType)),void 0!==a.iOption&&o.setIoption(Number(a.iOption)),void 0!==a.content&&o.setStmsgcontent(a.content),t.setStsearchinfo(n),t.setStimmsgfilter(o),payload=t,r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SEARCH_IM_MSG,payload:payload,callback:e.callback,tag:e.tag})},swGetPuGroupList:function(e){var t=s.RcCode.RC_CODE_E_UNSUPPORTED;return l.CheckOcx()?t:void 0===e?(console.error("params not set"),s.RcCode.RC_CODE_E_INVALIDARG,t):void 0===e.callback||"function"!=typeof e.callback?(console.error("callbak not set"),s.RcCode.RC_CODE_E_INVALIDARG,t):t=r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_GROUPLIST,callback:e.callback,tag:e.tag})},swPuGroupFillGroupList:function(e){this.swGetPuGroupList({callback:function(t,n,o){t.tag.__swPuGroupFillGroupList(e,o)},tag:this})},__reStrcutGroup:function(e){var t=[],n=[];for(var o in e)""==e[o].szparentid?t.push(e[o]):n.push(e[o]);var i=function(e,t){var n="",o=null,s=null;for(var r in e){n=(s=e[r]).szid,s.items=[];var a=[];for(var l in t)(o=t[l])&&n==o.szparentid&&(s.items.push(o),t[l]=null,a.push(o));i(a,t)}};return i(t,n),t},__swPuGroupFillGroupList:function(e,t){var n=s.RcCode.RC_CODE_E_UNSUPPORTED;if(l.CheckOcx())return n;if(void 0===e.callback||"function"!=typeof e.callback)return console.error("callbak not set"),s.RcCode.RC_CODE_E_INVALIDARG,n;e.filterCallback;var o=e.filterCallback,i=e.filterListCallback;let r=this._loopFilterNULLPuGroup.bind(this);if(void 0===e)return console.error("params not set"),s.RcCode.RC_CODE_E_INVALIDARG,n;var a=t.list,u=[];this._loopStructureData(a,this._loopStructureData,u);var c=this.__reStrcutGroup,_=this,d=[],p=[],h=function(t,n){n<t.length&&this.swGetPuGroupInfo({info:{groupid:t[n].szid},callback:function(s,a,l){t[n].szpu=[];var g="",f=null,C=!0;for(var m in l.ppuidList){g=l.ppuidList[m],f=_.swGetPu(g);try{C=!0,o&&(C=o(f)),"boolean"==typeof C&&C?t[n].szpu.push(f):"object"==typeof C&&t[n].szpu.push(C),C&&d.push(g),i&&p.push(g)}catch(e){alert(e)}}if(++n<t.length&&h(t,n),n==t.length){var E=[],y=null,S=null,R=null,v=null;for(var I in _._arr_pu)S=_._arr_pu[I],y=S._id_pu,R=d,i&&(R=p),0==R.some((function(e){return e===y}))&&(v=S,i&&(v=i(S))&&(v="object"==typeof v?v:S),v&&E.push(S));u=c(u),o&&(u=r(u)),e.callback({tag:e.tag},{emms:{code:0}},{result:u,pulist:E})}}})};return h=h.bind(this),u.length>0?h(u,0):e.callback({tag:e.tag},{emms:{code:0}},{result:[],pulist:_._arr_pu}),n},_impFilterNULLPuGroup:function(e,t){for(var n=null,o=null,i=0;i<t.length;i++)o=(n=t[i]).items,n.items=[],o.length>0&&this._impFilterNULLPuGroup(n.items,o),(n.items.length>0||n.szpu.length>0)&&e.push(n);return e.length},_loopFilterNULLPuGroup:function(e){var t=[];return this._impFilterNULLPuGroup(t,e),t},_loopStructureData:function(e,t,n){for(var o in e)n.push(e[o]),t(e[o].items,t,n)},swGetPuGroupInfo:function(e){var t=s.RcCode.RC_CODE_E_UNSUPPORTED;if(l.CheckOcx())return t;if(void 0===e)return console.error("params not set"),s.RcCode.RC_CODE_E_INVALIDARG,t;if(void 0===e.callback||"function"!=typeof e.callback)return console.error("callbak not set"),s.RcCode.RC_CODE_E_INVALIDARG,t;var n=new proto.BVCU.PUConfig.GroupInfo;return n.setSzid(e.info.groupid),t=r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_GROUPINFO,callback:e.callback,payload:n,tag:e.tag})},swPuAddGroup:function(e){var t=s.RcCode.RC_CODE_E_UNSUPPORTED;if(l.CheckOcx())return t;if(void 0===e)return console.error("params not set"),s.RcCode.RC_CODE_E_INVALIDARG,t;if(void 0===e.callback||"function"!=typeof e.callback)return console.error("callbak not set"),s.RcCode.RC_CODE_E_INVALIDARG,t;var n=new proto.BVCU.PUConfig.GroupInfo;if(void 0!==e.info.name?n.setSzname(e.info.name):n.setSzname(""),void 0===e.info.groupid)return s.RcCode.RC_CODE_E_INVALIDARG;if(n.setSzid(e.info.groupid),void 0!==e.info.parentid){if(e.info.groupid==e.info.parentid)return console.error("设备组父ID不能为自身ID"),s.RcCode.RC_CODE_E_INVALIDARG;n.setSzparentid(e.info.parentid)}if(void 0!==e.info.desc&&n.setSzdescription(e.info.desc),void 0!==e.info.szpu)for(var o=0;o<e.info.szpu.length;o++)n.addPpuid(e.info.szpu[o]);return t=r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_PU_ADDGROUP,callback:e.callback,payload:n,tag:e.tag})},swPuModGroup:function(e){var t=s.RcCode.RC_CODE_E_UNSUPPORTED;if(l.CheckOcx())return t;if(void 0===e)return console.error("params not set"),s.RcCode.RC_CODE_E_INVALIDARG,t;if(void 0===e.callback||"function"!=typeof e.callback)return console.error("callbak not set"),s.RcCode.RC_CODE_E_INVALIDARG,t;if(void 0===e.info)return s.RcCode.RC_CODE_E_INVALIDARG,t;var n=new proto.BVCU.PUConfig.GroupInfo;if(void 0!==e.info.name?n.setSzname(e.info.name):n.setSzname(""),void 0===e.info.groupid)return s.RcCode.RC_CODE_E_INVALIDARG;if(n.setSzid(e.info.groupid),void 0!==e.info.parentid?n.setSzparentid(e.info.parentid):n.setSzparentid(""),void 0!==e.info.desc?n.setSzdescription(e.info.desc):n.setSzdescription(""),void 0!==e.info.szpu)for(var o=0;o<e.info.szpu.length;o++)n.addPpuid(e.info.szpu[o]);return t=r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_PU_MODGROUP,callback:e.callback,payload:n,tag:e.tag})},swPuDelGroup:function(e){var t=s.RcCode.RC_CODE_E_UNSUPPORTED;if(l.CheckOcx())return t;if(void 0===e)return console.error("params not set"),s.RcCode.RC_CODE_E_INVALIDARG,t;if(void 0===e.callback||"function"!=typeof e.callback)return console.error("callbak not set"),s.RcCode.RC_CODE_E_INVALIDARG,t;var n=new proto.BVCU.PUConfig.GroupInfo;return n.setSzid(e.info.groupid),t=r.SendRequest({session:this,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_PU_DELGROUP,callback:e.callback,payload:n,tag:e.tag})},swDispose:function(){if(this._arr_pu_online&&this._arr_pu_online.length>0&&(this._arr_pu_online.every((function(e,t,n){e._clear()})),this._arr_pu_online=[]),this._timer_keeplive&&(clearInterval(this._timer_keeplive),this._timer_keeplive=0),this._ws&&(this._ws.onclose=null,this._ws.close(),console.log("close ws")),l.CheckNotOcx()){var e=s.DependencyMgr.GetModule("Audio");e&&e.DestroyWs()}s.SWVideoChanel._Ocx_PlayObjMgr.Free()},compare:function(e){return this._server==e._server&&this._port==e._port&&this._user==e._user},_internalOnResponseFail:function(e,t,n){var o=e.cmd;e.param;o==r.RequestHeader.pubkey.cmd&&(o=r.RequestHeader.login.cmd)},_internalOnResponseSuccess:function(e,t,n){s.DependencyMgr.HandleResponseInJect((function(o){o.internalOnResponseSuccess(this,e,t,n)}),this)},_internalNotify:function(e,t){s.DependencyMgr.HandleResponseInJect((function(n){n.handleNotify(this,e,t)}),this)},_internalOnResponsePulist:function(e){var t=[];if(e&&"function"==typeof e.forEach){var n=null,o=this;e.forEach((function(e){(n=o._arr_pu_index[e.szid])?(n._internalUpdate(e),o._swCheckPuArr(n)):(1==(n=new s.SWPu(o,e))._info_pu.onlinestatus?o._arr_pu_online.push(n):0==n._info_pu.onlinestatus&&o._arr_pu_offline.push(n),o._arr_pu.push(n),o._arr_pu_index[e.szid]=n),t.push(n)}))}return t},_internalOnResponseConfList:function(e){null!=this._confManager&&this._confManager._swFreshConflist&&this._confManager._swFreshConflist(e)},_internalOnConfResponse:function(e,t){switch(e){case proto.WEBBVCU.MSGType.WEB_BVCU_GET_CONF_LIST:null!=this._confManager&&this._confManager._swFreshConflist&&this._confManager._swFreshConflist(t);break;case proto.WEBBVCU.MSGType.WEB_BVCU_GET_CONF_INFO:return this._confManager._swFreshConfInfo(t);case proto.WEBBVCU.MSGType.WEB_BVCU_SET_CONF_CREATE:var n=this._confManager._swFreshConfInfo(t);return this._confManager._dispatchCallback(n,r.RequestHeader.confnotify.notifyconfcreate.cmd,n.swGetConfInfo().id),n;case proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_ONLINE:this._confManager._swFreshUserOnlielist(t);break;case proto.WEBBVCU.MSGType.WEB_BVCU_SET_CONF_DELETE:this._confManager._onConfDeletedOk(t);break;case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_PARTICIPATOR_ADD:case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_PARTICIPATOR_REMOVE:this._confManager._onParticularAddResult(t);break;case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_START:case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_STOP:this._confManager._onConfOpertaion(t);break;case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_PARTICIPATOR_APPLYFOR_STARTSPEAK:case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_PARTICIPATOR_APPLYFOR_ENDSPEAK:this._confManager._onApplyForSpeak(t);break;case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_RETURN:case proto.WEBBVCU.MSGType.WEB_BVCU_CONF_LEAVE:this._confManager._onConfLeaveOrReturn(t)}}}},function(e,t,n){var o=n(0),i=o.jSW,s=o.jSWProtocol,r=o.jSWUtils;o.jSWOptions,o.PuLoad,o.AudioMgr,o.HTTPNruFile;i.SwUserManager=function(e){this._session=e},i.SwUserManager.SYSADMIN={NONE:0,GROUP:1,USER:4,DEV:16,DEVASS:64,ALL:85},i.SwUserManager.PERMISSIONS={OFF:0,ON:1},i.SwUserManager.DEFAULT={GROUP_GOD:"Admin",USER:"admin"},i.SwUserManager.Buffer=function(){this._Buffer_Strack=[]},i.SwUserManager.Buffer.prototype={_Buffer_Size:1024,_push:function(e){if(!this._is_id_exist(e.id)){for(;this._Buffer_Strack.length>this._Buffer_Size;){(e=this._Buffer_Strack.pop()).tag._clearinfo(e.tag)}this._Buffer_Strack.unshift(e)}},_is_id_exist:function(e){for(itemIndex in this._Buffer_Strack)if(this._Buffer_Strack[itemIndex].id==e)return!0;return!1},_clear:function(){this._Buffer_Strack=[]}},i.SwUserManager.SwUser=function(e,t,n){this._session=e,this._user=t,this._group=n,this._userinfo=null},i.SwUserManager.SwUser.prototype={_static_buffer:new i.SwUserManager.Buffer,_clearinfo:function(e){e._userinfo=null},swGetUserInfo:function(e){return this._static_buffer._is_id_exist(this._user.id)?(setTimeout(e.callback,5,{tag:e.tag},{emms:{code:0}},this._userinfo),i.RcCode.RC_CODE_S_OK):this._innerGetUserInfo(e)},swGetGroup:function(){return this._group},swModUser:function(e){var t={info:{name:this._user.name,email:this._userinfo.email,phone:this._userinfo.phone,description:this._userinfo.description,groupid:this._group._group.id,sysadmin:{isGroup:this._userinfo.isGroup,isUser:this._userinfo.isUser,isDev:this._userinfo.isDev,isDevAss:this._userinfo.isDevAss},resources:this._userinfo.resources,iptz:this._userinfo.iptz},callback:null,tag:null};return(e=r.extend({},t,e||{})).info.sysadmin=r.extend({},t.info.sysadmin,e.info.sysadmin||{}),this._mod_user(e)},_mod_user:function(e){var t=new proto.BVCU.UserConfig.UserInfo,n=0;return n+=e.info.sysadmin.isGroup?i.SwUserManager.SYSADMIN.GROUP:i.SwUserManager.SYSADMIN.NONE,n+=e.info.sysadmin.isUser?i.SwUserManager.SYSADMIN.USER:i.SwUserManager.SYSADMIN.NONE,n+=e.info.sysadmin.isDev?i.SwUserManager.SYSADMIN.DEV:i.SwUserManager.SYSADMIN.NONE,n+=e.info.sysadmin.isDevAss?i.SwUserManager.SYSADMIN.DEVASS:i.SwUserManager.SYSADMIN.NONE,t.setSname(e.info.name),t.setSemail(e.info.email),t.setSphone(e.info.phone),t.setSdescription(e.info.description),t.setIsysadmin(n),t.setIptz(e.info.iptz),t.setSid(this._userinfo.id),t.setSallocateid(this._userinfo.allocateId),t.setSgroupid(e.info.groupid),s._LocalResource_2Pb(e.info.resources,t),s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_MODUSER,payload:t,callback:e.callback,tag:e.tag})},swModPwd:function(e){return e=r.extend({},{data:{password:"",newpassword:""},callback:null,tag:null},e||{}),this._mod_pwd(e)},_mod_pwd:function(e){var t=new proto.BVCU.UserConfig.ModPassword;return t.setSid(this._user.id),t.setSpassword(r.string2Uint8Array(e.data.password)),t.setSnewpassword(r.string2Uint8Array(e.data.newpassword)),s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_MODPASSWD,payload:t,callback:e.callback,tag:e.tag})},swDelUser:function(e){return this._del_user(e)},_del_user:function(e){var t=new proto.BVCU.UserConfig.User;return t.setSid(this._user.id),t.setSgroupid(this._user.groupid),s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_DELUSER,payload:t,callback:e.callback,tag:e.tag})},_fresh_user_info:function(e){this._userinfo={id:e.sId,passwd:e.sPasswd,bsetpasswd:e.bSetPasswd,sysadmin:{isGroup:e.sysadmin.isGroup,isUser:e.sysadmin.isUser,isDev:e.sysadmin.isDev,isDevAss:e.sysadmin.isDevAss},iptz:e.iPtz,serverid:e.sServerId,groupid:e.sGroupId,imaxsession:e.iMaxSession,allocateId:e.sAllocateId,name:e.sName,phone:e.sPhone,email:e.sEmail,description:e.sDescription,resources:e.Resource.concat()},this._user={id:e.sId,groupid:e.sGroupId,name:e.sName}},_getUserInfo:function(e){var t=new proto.BVCU.UserConfig.User;return t.setSid(e.userid),t.setSgroupid(e.groupid),s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_USERINFO,payload:t,callback:e.callback,tag:e.tag})},_innerGetUserInfo:function(e){return this._getUserInfo({userid:this._user.id,groupid:this._user.groupid,callback:this._innerOnGetUserInfo,tag:{user:this,option:e}})},_innerOnGetUserInfo:function(e,t,n){var o=e.tag,i=o.user,s=o.option;i._getGroupInfo({callback:i._innerhelpOnGetUserInfo,tag:{option:s,data:n,user:i}})},_innerhelpOnGetUserInfo:function(e,t,n){var o=e.tag,s=o.user,r=o.option,a=o.data;(s._fresh_user_info(a),i.SwUserManager._InitIUserHelp.iCount-=1,i.SwUserManager._InitIUserHelp.iCount<=0)&&s._session.swGetUserManager()._onInitOver();null!=r.callback&&"function"==typeof r.callback&&r.callback({tag:r.tag},{emms:{code:0}},s._userinfo),s._static_buffer._push({id:s._userinfo.id,tag:s})},_getGroupInfo:function(e){this._group.swGetGroupInfo(e)}},i.SwUserManager._InitIUserHelp={iCount:0},i.SwUserManager.SwGroup=function(e,t,n){this._session=e,this._group=t,this._userlist=[],this.groupinfo=null,this._groupinfo=null,null!=n&&(this._groupinfo=n,this.groupinfo=n)},i.SwUserManager.SwGroup.prototype={_static_groupinfo_buffer:new i.SwUserManager.Buffer,_clearinfo:function(e){e._groupinfo=null,e.groupinfo=null},_getGroupInfo:function(e){var t=new proto.BVCU.UserConfig.UserGroup;return t.setSid(this._group.id),s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_GROUPINFO,payload:t,callback:this._onGetGroupInfo,tag:{group:this,option:e}})},_resolve:function(){this.groupinfo={id:this._group.id,name:this._groupinfo.name,parentid:this._groupinfo.parentid,description:this._groupinfo.description,resources:this._groupinfo.resources.concat(),allresources:[]},this.groupinfo.id!=i.SwUserManager.DEFAULT.GROUP_GOD&&(this.groupinfo.allresources=s._GetAllRescources(this._session,this.groupinfo.resources))},_onGetGroupInfo:function(e,t,n){var o=e.tag,i=o.group;i._groupinfo=n,i._resolve();var s=o.option;null!=s.callback&&"function"==typeof s.callback&&s.callback({tag:s.tag},{emms:{code:0}},n),i._static_groupinfo_buffer._push({id:i._group.id,tag:i})},_groupSetFilter:function(){this.groupinfo.id=this._group.id,this.groupinfo.parentid=this._group.parentid},_mod_group:function(e){var t=new proto.BVCU.UserConfig.UserGroupInfo;return t.setSid(this._group.id),t.setSname(e.info.name),t.setSdescription(e.info.description),t.setSparentid(e.info.parentid),s._LocalResource_2Pb(e.info.resources,t),s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_MODGROUP,payload:t,callback:e.callback,tag:e.tag})},_del_group:function(e){var t=new proto.BVCU.UserConfig.UserGroup;return null==this._userlist?(console.warn("please get group info before delete it!"),i.RcCode.RC_CODE_E_FAIL):null!=this._userlist&&this._userlist.length>0?(console.warn("we can't delete the group because it contains more than 1 user!"),i.RcCode.RC_CODE_E_FAIL):(t.setSid(this._group.id),t.setSparentid(this._group.parentid),s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_DELGROUP,payload:t,callback:e.callback,tag:e.tag}))},_add_user:function(e){var t=new proto.BVCU.UserConfig.UserInfo,n=0;return n+=e.info.sysadmin.isGroup?i.SwUserManager.SYSADMIN.GROUP:i.SwUserManager.SYSADMIN.NONE,n+=e.info.sysadmin.isUser?i.SwUserManager.SYSADMIN.USER:i.SwUserManager.SYSADMIN.NONE,n+=e.info.sysadmin.isDev?i.SwUserManager.SYSADMIN.DEV:i.SwUserManager.SYSADMIN.NONE,n+=e.info.sysadmin.isDevAss?i.SwUserManager.SYSADMIN.DEVASS:i.SwUserManager.SYSADMIN.NONE,t.setSid(e.info.id),e.info.passwd.length>0&&e.info.passwd.length<64?t.setSpasswd(r.string2Uint8Array(e.info.passwd)):e.info.passwd.length>64&&console.log("the passwd you seted is out of range"),t.setSname(e.info.name),t.setSemail(e.info.email),t.setSphone(e.info.phone),t.setSdescription(e.info.description),t.setIsysadmin(n),t.setIptz(e.info.iptz),t.setSallocateid(e.info.allocateId),t.setSgroupid(this._group.id),s._LocalResource_2Pb(e.info.resources,t),s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_ADDUSER,payload:t,callback:e.callback,tag:e.tag})},_onGetUser:function(e){var t=null,n=!1;for(userIndex in this._userlist)if((t=this._userlist[userIndex])._user.id==e.id){t._user=e,n=!0;break}n||(t=this._local_add_user(e));this._session.swGetUserManager();return t},_local_add_user:function(e){var t=new i.SwUserManager.SwUser(this._session,e,this);return this._userlist.push(t),t},_on_notify_mod_user:function(e){var t=null,n=!1;for(userindex in this._userlist){(t=this._userlist[userindex])._user.id==e.sId&&(n=!0);break}if(n)t._fresh_user_info(e);else{var o={id:e.sId,groupid:e.sGroupId,name:e.sName};(t=new i.SwUserManager.SwUser(this._session,o,this))._fresh_user_info(e),this._userlist.push(t)}return t},_on_notify_del_user:function(e){var t=null;for(userindex in this._userlist)if((t=this._userlist[userindex])._user.id==e._user.id){this._userlist.splice(userindex,1);break}return t},swAddUser:function(e){var t={info:{id:"",passwd:"",name:"",email:"",phone:"",description:"",groupid:this._group.id,sysadmin:{isGroup:!1,isUser:!1,isDev:!1,isDevAss:!1},resources:[]},callback:null,tag:null};return(e=r.extend({},t,e||{})).info=r.extend({},t.info,e.info||{}),this._add_user(e)},swGetUserList:function(e){return setTimeout(e.callback,5,{tag:e.tag},{emms:{code:i.RcCode.RC_CODE_S_OK}},this._userlist),i.RcCode.RC_CODE_S_OK},swGetUserById:function(e){var t=null;for(userIndex in this._userlist)if((t=this._userlist[userIndex])._user.id==e)return t;return null},swGetGroupInfo:function(e){return this._static_groupinfo_buffer._is_id_exist(this._group.id)?(setTimeout(e.callback,5,{tag:e.tag},{emms:{code:0}},this.groupinfo),i.RcCode.RC_CODE_S_OK):this._getGroupInfo(e)},swModGroup:function(e){var t={info:{name:this._group.name,description:this._groupinfo.description,parentid:this._groupinfo.parentid,resources:this._groupinfo.resources},callback:null,tag:null};return(e=r.extend({},t,e||{})).info=r.extend({},t.info,e.info||{}),this._mod_group(e)},swDelGroup:function(e){return this._del_group(e)}},i.SwUserManager.prototype={_session:null,_grouplist:[],_ondatachangedcallback:null,_initCallback:null,_usertag:null,_isInitOver:!1,_currentUser:null,_currentuserid:"",_clear:function(){i.SwUserManager.SwUser.prototype._static_buffer._clear(),i.SwUserManager.SwGroup.prototype._static_groupinfo_buffer._clear(),i.SwUserManager.prototype._initCallback=null,i.SwUserManager.prototype._usertag=null,i.SwUserManager.prototype._isInitOver=!1,i.SwUserManager.prototype._currentUser=null,i.SwUserManager.prototype._currentuserid="",i.SwUserManager.prototype._grouplist=[]},_getUserGroupList:function(e){var t=s.JsonParamCommand(this._session._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_GROUPLIST,s.BVCU_Command("",-1,null));return s._internalSend({cmd:s.RequestHeader.usercfg.getgrouplist.cmd,session:this._session,request:t,callback:e.callback,tag:e.tag})},_getUserList:function(e){return s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_USERLIST,callback:e.callback,tag:e.tag})},_innerGetUserList:function(){this._getUserList({callback:this._onGetUserList,tag:this})},_onGetUserList:function(e,t,n){var o=e.tag,s=null,r=null,a=null;for(userindex in i.SwUserManager._InitIUserHelp.iCount=n.length,n)s=n[userindex],null!=(r=o._getGroupById(s.groupid))&&(a=r._onGetUser(s))._user.id==o._currentuserid&&(o._currentUser=a);o._onInitOver()},_getGroupById:function(e){var t=null;for(groupindex in this._grouplist)if((t=this._grouplist[groupindex])._group.id==e)return t;return null},_getOnlineUsers:function(e){return s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_ONLINE,callback:e.callback,tag:e.tag})},_getOnlineUserInfo:function(e){var t=new proto.BVCU.UserConfig.UserOnline;return t.setSzdevid(e.devid),t.setSuserid(e.userid),t.setIapplierid(e.applierid),s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_USER_ONLINEINFO,payload:t,callback:e.callback,tag:e.tag})},_add_group:function(e){var t=new proto.BVCU.UserConfig.UserGroupInfo;return t.setSid(e.info.id),t.setSname(e.info.name),t.setSdescription(e.info.description),t.setSparentid(e.info.parentid),s._LocalResource_2Pb(e.info.resources,t),s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_ADDGROUP,payload:t,callback:e.callback,tag:e.tag})},_kickout_user:function(e){var t=new proto.BVCU.UserConfig.Kickout;return s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_USER_KICKOUT,payload:t,callback:e.callback,tag:e.tag})},_onInitOver:function(e){this._isInitOver&&!e||(this._isInitOver=!0,this._initCallback({tag:this._usertag},{emms:{code:0}},null))},_add_group_to_local:function(e,t){var n=new i.SwUserManager.SwGroup(e,t);this._grouplist.push(n)},_on_notify_mod_group:function(e){var t=!1,n=null;for(o in this._grouplist)if((n=this._grouplist[o])._group.id==e.id){t=!0;break}if(t)for(var o in n._groupinfo=e,n.groupinfo=e,n._group)n._group[o]=n.groupinfo[o];else{var s={id:e.id,name:e.name,parentid:e.parentid};n=new i.SwUserManager.SwGroup(this._session,s,e),this._grouplist.push(n)}return n},_on_notify_del_group:function(e){var t=null,n=!1;for(groupindex in this._grouplist)if((t=this._grouplist[groupindex])._group.id==e.id){this._grouplist.splice(groupindex,1),n=!0;break}return n?t:null},_on_notify_mod_user:function(e){var t=null,n=null;for(groupIndex in this._grouplist)if((t=this._grouplist[groupIndex])._group.id==e.sGroupId){n=t._on_notify_mod_user(e);break}var o=null;for(groupIndex in this._grouplist)(o=(t=this._grouplist[groupIndex]).swGetUserById(e.sId))&&o._user.groupid!=e.sGroupId&&o._group._on_notify_del_user(n);return n},_on_notify_del_user:function(e){var t=null;return null!=(t=this._getUserById(e.id))&&(t=t._group._on_notify_del_user(t)),t},onGetGroupList:function(e,t,n){var o=e.tag.userManager,i=null,s=null,r=!1;for(groupindex in n){for(localgroupindex in i=n[groupindex],o._grouplist)if(s=o._grouplist[localgroupindex],i.id==s._group.id){s._group=i,r=!0;break}r||o._add_group_to_local(this.session,i),r=!1}o._innerGetUserList()},_onNotify:function(e,t,n){if(this._isInitOver){var o=null,i="",r=null;switch(e){case proto.WEBBVCU.MSGType.WEB_BVCU_NOTIFY_USER_ADDGROUP:o=proto.BVCU.UserConfig.UserGroupInfo.deserializeBinary(n),o=s.GroupInfoPb_2Json(o,this._session),r=this._on_notify_mod_group(o),i=s.RequestHeader.usercfg.addgroup.cmd;break;case proto.WEBBVCU.MSGType.WEB_BVCU_NOTIFY_USER_MODGROUP:o=proto.BVCU.UserConfig.UserGroupInfo.deserializeBinary(n),o=s.GroupInfoPb_2Json(o,this._session),r=this._on_notify_mod_group(o),i=s.RequestHeader.usercfg.modgroupinfo.cmd;break;case proto.WEBBVCU.MSGType.WEB_BVCU_NOTIFY_USER_DELGROUP:o=proto.BVCU.UserConfig.UserGroup.deserializeBinary(n),o=s.GroupPb_2Json(o),r=this._on_notify_del_group(o),i=s.RequestHeader.usercfg.delgroup.cmd;break;case proto.WEBBVCU.MSGType.WEB_BVCU_NOTIFY_USER_ADDUSER:o=proto.BVCU.UserConfig.UserInfo.deserializeBinary(n),o=s.USER_USERINFO_Pb2Json(o,this._session),r=this._on_notify_mod_user(o),i=s.RequestHeader.usercfg.adduser.cmd;break;case proto.WEBBVCU.MSGType.WEB_BVCU_NOTIFY_USER_MODUSER:o=proto.BVCU.UserConfig.UserInfo.deserializeBinary(n),o=s.USER_USERINFO_Pb2Json(o,this._session),r=this._on_notify_mod_user(o),i=s.RequestHeader.usercfg.moduserinfo.cmd;break;case proto.WEBBVCU.MSGType.WEB_BVCU_NOTIFY_USER_DELUSER:o=proto.BVCU.UserConfig.User.deserializeBinary(n),o=s.USER_USERPb_2Json(o),r=this._on_notify_del_user(o),i=s.RequestHeader.usercfg.deluser.cmd}""!=i&&this._ondatachangedcallback(this,{},{cmd:i,target:r})}},swGetCurrentUser:function(){return this._isInitOver?this._currentUser:(console.log("please call get info function after init over!!!!!"),null)},swGetUAInfoByPuid:function(e){return"string"!=typeof e.targetId||0==e.targetId.length?i.RcCode.RC_CODE_E_FAIL:(e.devidorname=e.targetId,e.useridorname=null,this._SearchUAList(e))},swGetUAInfoByUserName:function(e){return"string"!=typeof e.targetId||0==e.targetId.length?i.RcCode.RC_CODE_E_FAIL:(e.devidorname=null,e.useridorname=e.targetId,this._SearchUAList(e))},_SearchUAList:function(e){return r.CheckOptionsCallback(e,(function(){var t=new proto.BVCU.Search.Search_Request,n=new proto.BVCU.Search.SearchInfo;t.setStsearchinfo(n),n.setItype(s.SearchType.UALIST),n.setIcount(Number(100)),n.setIpostition(Number(0));var o=new proto.BVCU.Search.Search_UAListFilter;return t.setStualistfilter(o),null!=e.devidorname&&o.setSzdevidorname(e.devidorname),null!=e.useridorname&&o.setSzuseridorname(e.useridorname),s.SendRequest({session:this._session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SEARCH_UALIST,payload:t,callback:e.callback,tag:e.tag})}),this)},swInit:function(e){if(null!=e&&null!=e.ondatachanged&&null!=e.callback)return this._ondatachangedcallback=e.ondatachanged,this._initCallback=e.callback,this._isInitOver?(this._onInitOver(!0),i.RcCode.RC_CODE_S_OK):(this._currentuserid=this._session._user,this._isInitOver=!1,this._usertag=e.tag,this._getUserGroupList({callback:this.onGetGroupList,tag:{userManager:this,isInit:!0}}));console.log("options must be fill correctly! please try again")},swGetCurrentUserId:function(){return this._currentuserid},swGetGroupList:function(e){return this._isInitOver?(setTimeout(e.callback,5,{tag:e.tag},{emms:{code:i.RcCode.RC_CODE_S_OK}},this._grouplist),i.RcCode.RC_CODE_S_OK):(console.log("please call get info function after init over!!!!!"),null)},swFormatGroupList:function(e){if("function"!=typeof e.callback)return i.RcCode.RC_CODE_E_INVALIDARG;var t=e.filterCallback,n=null,o=[],s=[],r=null,a=null,l=[],u=null,c=null;for(var _ in this._grouplist){a={info:(r=this._grouplist[_])._group,type:"1",children:[]};for(var d=0;d<r._userlist.length;d++)c={info:{allocateId:(u=r._userlist[d])._user.allocateId,name:u._user.name,id:u._user.id,groupid:u._user.groupid,description:u._user.description,email:u._user.email,sysadmin:u._user.sysadmin},user:u,type:"2",bReplace:!1},t&&((n=t(c.info))?"object"==typeof n&&(c.info=n,c.bReplace=!0):c=null),c&&a.children.push(c);""==r._group.parentid?o.push(a):s.push(a),l.push({target:a,group:r})}var p=this._FilterUserGroupNULLUser.bind(this),h=this._BuildStructureData;h(o,s,h);let g=function(e,t,n,o,i){if(0==e&&(i={iCount:0}),0!=o){if(!(e>=t.length)){if("2"==t[e].type){var s=t[e].user,r=t[e].bReplace;t[e]={info:t[e].info,type:t[e].type},s.swGetUserInfo({callback:function(e,t,s){var r=e.tag.user;0==e.tag.bReplace&&(r.info={allocateId:s.allocateId,name:s.name,id:s.id,groupid:s.groupid,description:s.description,email:s.email,sysadmin:s.sysadmin}),i.iCount++,i.iCount==o&&n()},tag:{user:t[e],bReplace:r}})}g(e+1,t,n,o,i)}}else n()},f=function(e,t,n){var o=null;e<t.length?(o=t[e]).group.swGetGroupInfo({callback:function(e,i,s){if(0==i.emms.code){o=o.target;var r=e.tag;o.info={description:s.description,id:s.id,parentid:s.parentid,name:s.name},o.info.isAmdin="Admin"==s.id;var a=r+1,l=o.children.filter((function(e){return"2"==e.type})).length;g(0,o.children,(function(){f(a,t,n)}),l)}else n(i.emms.code)},tag:e}):n(0)};return f(0,l,(function(){t&&(o=p(o)),setTimeout(e.callback,5,{tag:e.tag},{emms:{code:i.RcCode.RC_CODE_S_OK}},o)})),i.RcCode.RC_CODE_S_OK},_ImpFilterUserGroupNULLUser:function(e,t){for(var n=null,o=null,i=null,s=0;s<t.length;s++)i=(n=t[s]).children.filter((function(e){return"1"==e.type})),o=n.children.filter((function(e){return"2"==e.type})),n.children=o,i.length>0&&this._ImpFilterUserGroupNULLUser(n.children,i),n.children.length>0&&e.push(n);return e.length>0},_FilterUserGroupNULLUser:function(e){var t=[];return this._ImpFilterUserGroupNULLUser(t,e),t},_BuildStructureData:function(e,t,n){for(var o in e){tempGroup=e[o];var i=[];for(var s in t)tempGroupLite=t[s],tempGroupLite&&tempGroupLite.info.parentid==tempGroup.info.id&&(t[s]=null,tempGroup.children.push(tempGroupLite),i.push(tempGroupLite));n(i,t,n)}},swGetGroupById:function(e){return this._getGroupById(e)},swGetUserById:function(e,t){var n=this.swGetGroupById(e);return null==n?null:n.swGetUserById(t)},_getUserById:function(e){var t=null;for(groupindex in this._grouplist)if(group=this._grouplist[groupindex],null!=group&&null!=(t=group.swGetUserById(e)))break;return t},swAddGroup:function(e){var t=r.extend({},{info:{name:"",description:"",parentid:"",resources:[]},callback:null,tag:null},e||{});return this._add_group(t)}}},function(e,t,n){var o=n(0),i=o.jSW,s=o.jSWProtocol,r=o.jSWUtils,a=o.jSWOptions,l=(o.PuLoad,o.AudioMgr,o.HTTPNruFile);i.SWPu=function(e,t){this._parent=e,this._innerCommUpdata(t),r.debugLogInfo(this._info_pu.id+"v:"+this._arr_channel.length+",g"+this._arr_gps.length)},i.SWPu.SATELLITE={GPS:1,BDS:2,GLONASS:4,GALILEO:8,QZSS:16},i.SWPu.prototype={swReboot:function(){return i.RcCode.RC_CODE_E_UNSUPPORTED},swSetPuManualrecord:function(e){var t=new proto.BVCU.PUConfig.ManualRecord;return e=r.extend({},{isstart:1,ilength:-1,szFileName:"",callback:null},e||{}),t.setBstart(e.isstart),t.setIlength(s.Int2Uint(e.ilength)),t.setSzfilename(e.szFileName),s.SendRequest({session:this._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_MANUALRECORD,target:this._id_pu,payload:t,callback:e.callback,tag:e.tag})},swGetPuRecordStatus:function(e){return s.SendRequest({session:this._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_RECORDSTATUS,target:this._id_pu,callback:e.callback,tag:e.tag})},swPuControl:function(e){var t=s.CheckOptions(proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_REBOOT_OR_SHUTDOWN,e);return t!=i.RcCode.RC_CODE_S_OK?t:((new proto.WEBBVCU.PU_CONTROL).setIoption(e.ioption),t=s.SendRequest({session:this._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_REBOOT_OR_SHUTDOWN,target:this._id_pu,callback:e.callback,tag:e.tag}))},swSetPuSnapshot:function(e){var t=new proto.BVCU.PUConfig.Snapshot;return e=r.extend({},{istart:0,icyclecount:0,szftpid:null,callback:null,tag:null},e||{}),t.setBstart(e.istart),t.setIcyclecount(e.icyclecount),t.setSzftpid(e.szftpid),s.SendRequest({session:this._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_SNAPSHOT,target:this._id_pu,payload:t,callback:e.callback,tag:e.tag})},swGetChanel:function(e){for(var t=0;t<this._arr_channel.length;t++)if(this._arr_channel[t]._id_chanel==e)return this._arr_channel[t];for(t=0;t<this._arr_gps.length;t++)if(this._arr_gps[t]._id_chanel==e)return this._arr_gps[t];for(t=0;t<this._arr_tsp.length;t++)if(this._arr_tsp[t]._id_chanel==e)return this._arr_tsp[t];return null},swUploadFirmware:function(e){e=r.extend({},{pcallback:null},e||{});var t=i.RcCode.RC_CODE_E_INVALIDARG,n=e.file,o=e.remotepath;if(a.calltype==i.CallProtoType.OCX){if(n)if(0==n.indexOf("C:\\fakepath\\"))console.error("file path error");else{var u=new proto.WEBBVCU.DownFileFromPu;u.setSzlocalfilepathname(n),o&&u.setSzremotefilepathname(o),t=s.SendRequest({payload:u,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_UPLOAD_FILE_TONRU,session:this._parent,target:this._id_pu,callback:e.callback,callbackrelay:e.pcallback,tag:e.tag})}}else t=l.UploadToRoot(n,(function(){}),(function(t,n,o,s,r){0==o.indexOf("/")&&(o=o.slice(1)),e.pcallback&&e.pcallback({tag:e.tag},{emms:{code:t}},{sEvent:{iEvent:i.FileTransEvent.FILE_TRANS_CLOSE,iResult:t,szRemoteFilePath:o,szLocalFilePath:o,nruid:n},sProgressInfo:null}),e.callback&&e.callback({tag:e.tag},{emms:{code:t}})}));return t},swUpgradeFirmware:function(e){i.RcCode.RC_CODE_E_FAIL;e=r.extend({},{szNruId:"",szFilePath:"",szFileName:"",bPromptly:!0,callback:null,tag:null},e||{});var t=new proto.BVCU.PUConfig.Upgrade;return t.setSzftpid(e.szNruId),t.setSzfilepath(e.szFilePath),t.setSzfilename(e.szFileName),t.setBpromptly(e.bPromptly?1:0),s.SendRequest({session:this._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_UPGRADE,target:this._id_pu,payload:t,callback:e.callback,tag:e.tag})},swGetUpdateStatus:function(e){return s.SendRequest({target:this._id_pu,session:this._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_UPDATESTATUS,callback:e.callback,tag:e.tag})},_getGPSChannelById:function(e){for(var t in this._arr_gps)if(this._arr_gps[t]._id_chanel==e)return this._arr_gps[t];return null},_getTSPChannelById:function(e){for(var t in this._arr_tsp)if(this._arr_tsp[t]._id_chanel==e)return this._arr_tsp[t];return null},_getVideoChannelById:function(e){for(var t in this._arr_channel)if(this._arr_channel[t]._id_chanel==e)return this._arr_channel[t];return null},_innerCommUpdata:function(e){var t=e.pchannelList;this._info_pu={bootduration:e.ibootduration,boottime:s.Walltime2Json(e.stboottime),chanelcount:t.length,chanellist:[],id:e.szid,lat:e.ilatitude,long:e.ilongitude,name:e.szpuname,onlinestatus:e.ionlinestatus,onlinethrough:e.ionlinethrough,onlinetime:s.Walltime2Json(e.stonlinetime)},this._id_pu=this._info_pu.id,this._name_pu=this._info_pu.name,this._arr_tsp=[],void 0===this._arr_gps&&(this._arr_gps=[]),void 0===this._arr_channel&&(this._arr_channel=[]);for(var n=null,o=0;o<t.length;o++){var a=s.ChanelType.getType(t[o].ichannelindex);if(n=null,a==s.ChanelType.chanel){var l=this._getVideoChannelById(t[o].ichannelindex);l?l._updateInfo(t[o]):(l=new i.SWVideoChanel(this,t[o]),this._arr_channel.push(l),n=l)}else if(a==s.ChanelType.gps){var u=this._getGPSChannelById(t[o].ichannelindex);null==u?(u=new i.SWGPSChanel(this,t[o]),this._arr_gps.push(u),n=u):u._updateInfo(t[o])}else if(a==s.ChanelType.tsp){if(this._getTSPChannelById(t[o].ichannelindex))c._updateInfo(t[o]);else{var c=new i.SWTSPChanel(this,t[o]);this._arr_tsp.push(c),n=c}}n&&this._info_pu.chanellist.push(n)}r.debugLogInfo(this._info_pu.id+"v:"+this._arr_channel.length+",g"+this._arr_gps.length)},_internalUpdate:function(e){0==e.ionlinestatus&&this._clear(),this._innerCommUpdata(e)},compare:function(e){return!!this._parent.compare(e._parent)&&this._id_pu==e._id_pu},_clear:function(){for(var e=0;e<this._arr_channel.length;e++)this._arr_channel[e]._clear();for(e=0;e<this._arr_gps.length;e++)0==this._arr_gps[e]._info_chanel.status&&this._arr_gps[e].swClose();for(e=0;e<this._arr_tsp.length;e++)0==this._arr_tsp[e]._info_chanel.status&&this._arr_tsp[e].swClose()}}},function(e,t,n){var o=n(0),i=o.jSW,s=o.jSWProtocol,r=o.jSWUtils,a=o.jSWOptions;o.PuLoad,o.AudioMgr,o.HTTPNruFile;i.SWVideoChanel=function(e,t){this._parent=e,this._updateInfo(t),this._url_channel=null,this.m_live_hls=null,this.m_live_rtmp=null,this._session=this._parent._parent,this._commDlgMgr=new i.CommonDlgMgr(this._session),this.ismuti=!1,this._open_status=i.SWVideoChanel._OpenStatus.NOT_OPEND,this._intercom=new i.SWVideoChanel.InterCom(this),this.m_prototype=4},i.SWVideoChanel._OpenStatus={NOT_OPEND:0,OPENING:1,OPENED:2},i.SWVideoChanel._OcxFullScreen={_lastVideoChanel:null,_hDlg:-1,beforeFullScreen:function(e,t){this._lastVideoChanel=e,this._hDlg=t},onClickEsc:function(){a.CheckOcx()&&document.msFullscreenElement&&document.msExitFullscreen()},upDateDialog:function(){this._lastVideoChanel&&this._lastVideoChanel._updateDialog(this._hDlg),document.msFullscreenElement||(this._lastVideoChanel=null)},onFullScreenChange:function(){setTimeout(i.SWVideoChanel._OcxFullScreen.upDateDialog.bind(i.SWVideoChanel._OcxFullScreen),200)}},i.SWVideoChanel._Ocx_PlayObjMgr={GetPlayObj:function(e){var t=this.TryGetAnPlayObj(e);return null==t&&((t=this.CreatePlayObj(e)).used=!0),t},FreePlayObj:function(e){e&&e.used&&(e.used=!1)},_szTargetPlayObj:[],CreatePlayObj:function(e){var t=document.createElement("object");return t.classid=e?"clsid:0c85b239-904a-4adf-8424-f1928b38f12f":"clsid:CDE6C639-4BA8-4A09-81EB-DCE76A61FE98",t.style.width="100%",t.style.height="100%",t.style.display="block",this._szTargetPlayObj.push(t),t.used=!1,t.bWindowless=e,t},CheckPlayObjFit:function(e,t){return 0==e.used&&e.bWindowless==t},TryGetAnPlayObj:function(e){for(var t=null,n=0;n<this._szTargetPlayObj.length;n++)if(this.CheckPlayObjFit(this._szTargetPlayObj[n],e)){(t=this._szTargetPlayObj[n]).used=!0;break}return t},Free:function(){this._szTargetPlayObj=[]}},document.addEventListener("keydown",(function(){var e=window.event||arguments[0];27==e.keyCode&&i.SWVideoChanel._OcxFullScreen.onClickEsc()})),i.SWVideoChanel.prototype={_updateInfo:function(e){this._info_chanel={id:e.ichannelindex,name:e.szname,ptz:e.iptz,media:e.imediadir,status:0},this._id_chanel=this._info_chanel.id,this._name_chanle=this._info_chanel.name,this._meida_chanel=this._info_chanel.media,this._ptz_chanel=this._info_chanel.ptz},swSetControlParam:function(e){var t=i.RcCode.RC_CODE_E_UNSUPPORTED;if(a.CheckOcx()){if(null==typeof e.Idelayvssmooth)return i.RcCode.RC_CODE_E_INVALIDARG;var n=new proto.WEBBVCU.ParamsDialogControl;return n.setIdelayvssmooth(e.Idelayvssmooth),t=this._autoDlgSendProxy(e,(function(e){return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_DIALOG_PARAM,payload:n}}))}return t},swSrcType:function(e){var t="unknown";return this._autoDlgProxy(e,(function(e,n,o,i,r){e._prototype==s.ProtoType.HLS?t="hls":e._prototype==s.ProtoType.OCX?t="ocx":e._prototype==s.ProtoType.RTMP&&(t="rtmp")})),t},localRecords:[],_notifyDialogEventStorage:function(e,t){var n=null,o=!1;for(iIndex in this.localRecords)if((n=this.localRecords[iIndex]).szfilename==t.szfilename){o=!0;break}switch(o||(n={iresult:i.RcCode.RC_CODE_S_OK,szfilename:t.szfilename,itimestampbegin:0,itimestampend:0},this.localRecords.push(n)),e){case proto.WEBBVCU.MSGType.WEB_NOTIFY_BVCU_EVENT_STORAGE_FILE_OPEN:n.itimestampbegin=t.itimestamp,n.iresult=t.iresult;break;case proto.WEBBVCU.MSGType.WEB_NOTIFY_BVCU_EVENT_STORAGE_FILE_CLOSE:n.itimestampend=t.itimestamp,n.iresult=t.iresult;break;case proto.WEBBVCU.MSGType.WEB_NOTIFY_BVCU_EVENT_STORAGE_ERROR:n.iresult=t.iresult}if((e==proto.WEBBVCU.MSGType.WEB_NOTIFY_BVCU_EVENT_STORAGE_FILE_CLOSE||e==proto.WEBBVCU.MSGType.WEB_NOTIFY_BVCU_EVENT_STORAGE_ERROR)&&null!=this._callbackAfterRecordHasResult){var s={channel:this,storage:n};this._callbackAfterRecordHasResult(s)}},_callbackAfterRecordHasResult:null,_videoPlayer:null,_iVideoPlayerRotate:0,_OnNeedSaveVideoPlayer:function(e){this._videoPlayer=e,this._iVideoPlayerRotate=0},swFullScreen:function(e){return this._autoDlgProxy(e,(function(e,t,n,o,s){if(a.CheckOcx()){var r=e.getPlayDiv().bv_uuid+"_0077554tempdiv",l=document.getElementById(r);document.onmsfullscreenchange||(document.onmsfullscreenchange=i.SWVideoChanel._OcxFullScreen.onFullScreenChange),document.msFullscreenElement?document.msExitFullscreen():(i.SWVideoChanel._OcxFullScreen.beforeFullScreen(this,s),l.msRequestFullscreen())}else if(a.calltype==i.CallProtoType.HTTP){if(document.fullscreenElement)document.exitFullscreen();else(l=e.getPlayDiv())&&l.requestFullscreen()}return i.RcCode.RC_CODE_S_OK}))},swGetStatisticsInfo:function(e){i.RcCode.RC_CODE_E_UNSUPPORTED;return a.CheckNotOcx(),this._autoDlgSendProxy(e,(function(e){return{msgtype:proto.WEBBVCU.MSGType.WEB_GET_DIALOG_INFO}}))},swGetDialogInfo:function(e){var t=new proto.BVCU.CMSConfig.CMSCFG_DialogInfo,n=new proto.BVCU.CMSConfig.CMSCFG_ChannelInfo;n.setSzid(this._parent._id_pu),t.setSttarget(n),t.setIchannelindex(this._id_chanel);s.SendRequest({session:this._parent._parent,payload:t,msgtype:proto.WEBBVCU.MSGType.WEB_GET_CMS_DIALOGINFO,callback:e.callback,tag:e.tag});return i.RcCode.RC_CODE_S_OK},swVideoRotate:function(e){return this._autoDlgProxy(e,(function(t,n,o,s,r){var l=t.getRotate();if(l+=e.irotate,a.CheckOcx())return this._swOnDivSizeChange(l,r,e);if(a.CheckHttp()){if((l=e.irotate)%90!=0)return console.error(o," ",s,"rotate degree is not multiple of 90"),i.RcCode.RC_CODE_E_FAIL;if(null==this._videoPlayer)return console.error(o+" "+s+" video rotate faild, due not playing"),i.RcCode.RC_CODE_E_FAIL;if(null==this._videoPlayer._mediaElement.parentNode)return console.error(o+" "+s+" video rotate faild, parent node not exist"),i.RcCode.RC_CODE_E_FAIL;var u=this._videoPlayer._mediaElement.style,c=this._videoPlayer._mediaElement.parentNode,_=l%360/90,d=c.clientHeight/c.clientWidth,p=this._videoPlayer._mediaElement.videoHeight/this._videoPlayer._mediaElement.videoWidth,h=1/d,g=1/p;if(0==_)u.objectFit="contain",u.transform="none";else if(1==_||3==_){u.objectFit="fill";var f=1,C=1;f=d,C=d,g>d?C*=p/d:f*=g/h,u.transform=1==_?"rotate(90deg) scaleY("+C+") scaleX("+f+")":"rotate(270deg) scaleY("+C+") scaleX("+f+")"}else 2==_&&(u.objectFit="contain",u.transform="rotate(180deg)");return setTimeout(e.callback,50,{tag:e.tag},{emms:{code:i.RcCode.RC_CODE_S_OK}}),i.RcCode.RC_CODE_S_OK}}))},swVideoStretch:function(e){var t=i.RcCode.RC_CODE_S_OK;return a.CheckNotOcx()?(t=this._autoDlgProxy(e,(function(t){return t._mdiv&&t._mdiv.getElementsByTagName("video").length>0?(e.bStretch?$(t._mdiv.getElementsByTagName("video")[0]).css("object-fit","fill"):$(t._mdiv.getElementsByTagName("video")[0]).css("object-fit","contain"),i.RcCode.RC_CODE_S_OK):(r.debugLogInfo("present div not found, stretch video fail"),i.RcCode.RC_CODE_E_NOTFOUND)})),e.callback&&setTimeout(e.callback,50,{tag:e.tag},{emms:{code:t}})):t=this._autoDlgSendProxy(e,(function(t){var n=new proto.WEBBVCU.CommonData;return n.setIdata1(e.bStretch?1:0),{msgtype:proto.WEBBVCU.MSGType.WEB_VIDEO_DIALOG_STRETCH,payload:n}})),t},swLocalSnapshot:function(e){if(a.CheckHttp()){i.RC_CODE_E_UNSUPPORTED;return this._autoDlgProxy(e,(function(t){var n=null;if(t._mdiv){var o=t._mdiv.getElementsByTagName("video");1==o.length&&(n=r.Snapshot(o[0],o[0].videoWidth,o[0].videoHeight))}if(e.callback){var s=n?i.RcCode.RC_CODE_S_OK:i.RcCode.RC_CODE_E_FAIL;setTimeout(e.callback,50,{tag:e.tag},{emms:{code:s}},n)}return i.RC_CODE_S_OK}))}return e.szFileName&&0!=e.szFileName.length?this._autoDlgSendProxy(e,(function(t){var n=new proto.WEBBVCU.CommonData;return n.setIdata1(e.iQuality?e.iQuality:100),n.setSzdata(r.string2Uint8Array(e.szFileName)),{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_LOCAL_SNAPSHOT,payload:n}})):(console.log("swLocalSnapshot SzFilePath Is Invalid"),i.RcCode.RC_CODE_E_INVALIDARG)},_updateDialog:function(e){var t=i.RcCode.RC_CODE_E_UNSUPPORTED;return a.CheckOcx()?t=this._commSendProxy(options,(function(){return{msgtype:proto.WEBBVCU.MSGType.WEB_VIDEO_DIALOG_UPDATE,hdlg:e}})):t},_swOnDivSizeChange:function(e,t,n){var o=new proto.WEBBVCU.VideoDialogRotate;o.setSzpuid(r.string2Uint8Array(this._parent._id_pu)),o.setIchannelindex(this._id_chanel),o.setIrotate(e);s.SendRequest({session:this._parent._parent,payload:o,msgtype:proto.WEBBVCU.MSGType.WEB_VIDEO_DIALOG_ROTATE,hdlg:t,callback:n.callback,tag:n.tag});return i.RcCode.RC_CODE_S_OK},_onOcxChanelChange:function(e,t,n){i.CallProtoType.OCX,a.calltype},_pushCommDlg:function(e,t){this._commDlgMgr.push(e,t)},ismutidhlg:0,_buildHdlg:function(e,t){return e},_beginOpen:function(){this.ismuti||(this._open_status=i.SWVideoChanel._OpenStatus.OPENING)},_endOpenHasResult:function(e){this.ismuti||(this._open_status=e?i.SWVideoChanel._OpenStatus.OPENED:i.SWVideoChanel._OpenStatus.NOT_OPEND)},_closeHasResult:function(e){this.ismuti||e&&(this._open_status=i.SWVideoChanel._OpenStatus.NOT_OPEND)},_checkCanOpen:function(e){return this.ismuti=e,!!this.ismuti||this._open_status==i.SWVideoChanel._OpenStatus.NOT_OPEND},_fillOpenParam:function(e){this.ismuti=e},_autoDlgProxy:function(e,t,n){var o=this._getOptsHdlg(e);if(this.ismuti&&(void 0===o||-1==o))return console.log("can't find the dialog from you hdlg"),i.RcCode.RC_CODE_E_INVALIDARG;var s=this.ismuti?this._commDlgMgr.get(o):this._commDlgMgr.getDefault();return null==s?(console.log("can't find the dialog from you hdlg, maybe it's been closed"),i.RcCode.RC_CODE_E_NOTFOUND):(o=s.getHDlg(),this._commProxy((function(e,i,r){return t.bind(this)(s,e,i,r,o,n)})))},_getOptsHdlg:function(e){return e&&void 0!==e.hdlg?e.hdlg:-1},_getDesDiv:function(e){return"string"==typeof e?document.getElementById(e):e},_commProxy:function(e){return null==this._parent||null==this._parent._parent?(console.error("internal error, this._parent is null"),i.RcCode.RC_CODE_E_FAIL):e.bind(this)(this._parent._parent,this._parent._id_pu,this._id_chanel)},_commSendProxy:function(e,t){return this._commProxy((function(n,o,i){var a={payload:null,msgtype:-1,cmd:"",hdlg:-1,callback:e?e.callback:null,tag:e?e.tag:null},l=t.bind(this)();return l=r.extend({},a,l||{}),s.SendRequest({session:n,target:o,targetIndex:i,msgtype:l.msgtype,callback:l.callback,payload:l.payload,hdlg:l.hdlg,tag:l.tag,cmd:l.cmd})}))},_autoDlgSendProxy:function(e,t,n){return this._autoDlgProxy(e,(function(o,a,l,u,c){var _={payload:null,msgtype:-1,cmd:"",hdlg:-1,callback:null,tag:null,bcancel:!1};null==o&&null==e.hdlg&&(o=_.hdlg);var d=t.bind(this)(o);d=r.extend({},_,d||{});var p=i.RcCode.RC_CODE_S_OK;return 0==d.bcancel&&(p=s.SendRequest({session:a,target:l,targetIndex:u,msgtype:d.msgtype,callback:e.callback,payload:d.payload,hdlg:c,tag:e.tag,cmd:d.cmd})),n&&n.bind(this)(o),p}))},swOpen:function(e){return this._commProxy((function(t,n,o){var a={callback:null,tag:null,prototype:"auto",media:i.MEDIADIR.VIDEORECV};e=r.extend({},a,e||{}),2==this._meida_chanel&&2!=e.media&&(e.media=2);var l=this._eventHandle.getProtoType(e.prototype,e.useoptions.bHttpFlv);if(i.RcCode.bFaild(l.rc))return l.rc;var u=l.prototype,c=e.tag.div,_=null,d=!1,p=e.useoptions.bwindowless,h=e.useoptions.bHttpFlv;if(2==u&&l.bHttpFlv&&(h=l.bHttpFlv,e.useoptions.bHttpFlv=l.bHttpFlv),null==c)console.warn("no have div ,we will not display the video stream, just throw stream url");else{var g=this._eventHandle.beforeOpenPreparePlayDiv(u,c,p,h);_=g.playObj,d=g.isNeedDelay}var f=!!e.useoptions.bovertcp,C=this._eventHandle.sendOpenChanel,m=s.BVCU_DialogParam(n,o,0,u,e.media,0,0,f);return!!e.useoptions.bstretch&&m.setBstretch(!0),p&&m.setBwindowless(!0),m.setUsews(!!e.useoptions.usews),d?(setTimeout((function(){C(t,e,_,m)}),500),i.RcCode.RC_CODE_S_OK):C(t,e,_,m)}))},swOpenEx:function(e){var t={callback:null,div:"",prototype:"auto",media:i.MEDIADIR.VIDEORECV,bovertcp:!1,tag:null,ismuti:!1,bstretch:!1,bwindowless:!1,bHttpFlv:!1,usews:!1},n=r.extend({},t,e||{});if(a.CheckHttp()&&"auto"==n.prototype&&(n.prototype="httpflv"),"httpflv"==n.prototype&&(n.prototype="rtmp",n.bHttpFlv=!0,n.usews=!0),!this._eventHandle.checkMedia(n.media))return i.RcCode.RC_CODE_E_INVALIDARG;if(!this._checkCanOpen(n.ismuti)){e.ismuti||console.log("current open chanel model is mutil open!");var o=i.RcCode.RC_CODE_E_ALREADYEXIST;return console.log(i.RcCode.trans(o)),i.RcCode.RC_CODE_E_ALREADYEXIST}this._beginOpen(),n.div=this._getDesDiv(n.div),null==n.div&&console.warn("no have div ,we will not display the video stream, just throw stream url");var s=this.swOpen({prototype:n.prototype,tag:{div:n.div,channel:this,userdata:n.tag},useoptions:n,media:n.media,callback:this._eventHandle.onSwOpenExHasResult});return i.RcCode.bFaild(s)&&this._endOpenHasResult(!1),s},_eventHandle:{getProtoType:function(e,t){var n={rc:i.RcCode.RC_CODE_S_OK,prototype:-1,bHttpFlv:t},o=-1;return a.calltype==i.CallProtoType.OCX?o=s.ProtoType.OCX:"hls"==e?o=s.ProtoType.HLS:"rtmp"==e?t||r.supportFlash()?o=s.ProtoType.RTMP:(console.error("not supported flash (rtmp)"),n.rc=i.RcCode.RC_CODE_E_UNSUPPORTED):"auto"==e&&(flvjs.getFeatureList().mseLiveFlvPlayback||r.supportFlash())?(o=s.ProtoType.RTMP,n.bHttpFlv=!0):o=t||r.supportFlash()?s.ProtoType.RTMP:s.ProtoType.HLS,n.prototype=o,n},sendOpenChanel:function(e,t,n,o){null!=n&&s.ProtoType.OCX==o.getProto()&&(o.setHwnd(n.GetWMHwnd()),n.style.display="block",o.getBwindowless()&&o.setHplayhandle(n.GetWMHwnd()));var i=s.JsonParamDialog(e._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_OPEN_CHANLE,o);return s._internalSend({cmd:s.RequestHeader.openchanle.cmd,session:e,request:i,callback:t.callback,opt:t,tag:t.tag})},beforeOpenPreparePlayDiv:function(e,t,n,o){var a=null,l=!1;void 0===t.bv_uuid&&(t.bv_uuid=r.generateUUID());var u=t.bv_uuid+"_0077553",c=document.getElementById(u);if(null!=c&&(c.style.display="none"),u=t.bv_uuid+"_0077554",null!=(c=document.getElementById(u))&&(c.style.display="none"),s.ProtoType.HLS==e||s.ProtoType.RTMP==e){var _=t.bv_uuid+"_0077553";null==(a=document.getElementById(_))&&((a=document.createElement("VIDEO")).setAttribute("id",_),a.setAttribute("class","video-js vjs-default-skin vjs-big-play-centered"),t.appendChild(a)),a.style.width="100%",a.style.height="100%",a.style.display="block"}else if(s.ProtoType.OCX==e){var d=(_=t.bv_uuid+"_0077554")+"tempdiv";if(null==(a=document.getElementById(_))){var p=document.getElementById(d);null==p&&((p=document.createElement("div")).id=_+"tempdiv",p.style.width="100%",p.style.height="100%"),p.style.display="block",t.appendChild(p),(a=i.SWVideoChanel._Ocx_PlayObjMgr.GetPlayObj(n)).id=_,a.tag=this,p.appendChild(a),l=!0;var h=_+"ocxeventid",g=document.getElementById(h);null==g&&((g=document.createElement("script")).id=_+"ocxeventid",g.type="text/javascript",g.setAttribute("for",_),g.setAttribute("event","OnHwndEvent(hwnd, ieventtype, pParam)"),g.text="jSW._swOcxPlayerOnEvent(ieventtype, this.tag);",document.body.appendChild(g))}}return{playObj:a,isNeedDelay:l}},onSwOpenExHasResult:function(e,t,n){var o=t.getPayload(),r=proto.WEBBVCU.Open_Dialog_Response.deserializeBinary(o),l=e.tag.channel,u=e.tag.userdata,c="",_=e.request.getPayload(),d=proto.WEBBVCU.BVCU_DialogParam.deserializeBinary(_),p=-1,h=i.RcCode.bSuccess(t.getCode()),g=d.getProto(),f=e.opt.useoptions,C=e.opt.useoptions.bHttpFlv;if(n.bHttFlv=C,C)var m=i.DependencyMgr.GetModule("HttpFlv");r.hasUrl()&&(c=r.getUrl());var E=null;if(h){if(r.hasHdlg()&&(p=l._buildHdlg(r.getHdlg(),g),n.setParams(e.tag.div,p,d.getMedia(),g),l._pushCommDlg(n,g)),null!=e.session){d.getId(),d.getMajor();var y=l;if(null!=y){var S;g==s.ProtoType.HLS?S=a.http+c:g==s.ProtoType.RTMP&&(S=C?m.buildUrlFromRtmpUrl(a.http,c,f.usews):"rtmp://"+a.ip+c);var R={hdlg:p};y._url_chanel={proto:y.swSrcType(R),url:S}}}if(null==e.tag.div||C||g!=s.ProtoType.HLS&&g!=s.ProtoType.RTMP)if(C){O=m.CreatePlayer(e.tag.div,S,n);E={hdlg:n._hDlg},null!=l&&l._OnNeedSaveVideoPlayer(O)}else g==s.ProtoType.OCX&&(E={hdlg:n._hDlg});else{var v=e.tag.div.bv_uuid+"_0077553";if(null==document.getElementById(v))return void console.error("not have player");var I=null,D=null;g==s.ProtoType.HLS?(I=a.http+c,y.ismuti&&(E={hdlg:n._hDlg})):g==s.ProtoType.RTMP&&(D="rtmp://"+a.ip+c,y.ismuti&&(E={hdlg:n._hDlg}));var O=videojs(v,{controlBar:!1,controls:!1},(function(){g==s.ProtoType.HLS?this.src({type:"application/vnd.apple.mpegurl",src:I}):g==s.ProtoType.RTMP&&this.src({type:"rtmp/flv",src:D}),this.play()}));null!=l&&l._OnNeedSaveVideoPlayer(O),n&&(n.Player=O)}}var U=e.opt;U&&U.useoptions&&"function"==typeof U.useoptions.callback&&(U.useoptions.tag=u,U.useoptions.callback(U.useoptions,t,E)),U&&U.useoptions&&U.useoptions.chanel&&(U.useoptions.chanel.m_live_hls=I,U.useoptions.chanel.m_live_rtmp=D,U.useoptions.chanel.m_live_httpflv=S),l&&l._endOpenHasResult(h)},afterCloseDlgClearResource:function(e){if(e){var t=e.bv_uuid+"_0077553",n=document.getElementById(t+"tempdiv"),o=document.getElementById(t);if(null!=o&&(o.parentNode.removeChild(o),null!=n&&n.parentNode.removeChild(n)),"undefined"!=typeof videojs)try{var s=videojs(t);s&&(s.dispose(),this._videoPlayer=null)}catch(e){}t=e.bv_uuid+"_0077554",o=document.getElementById(t),n=document.getElementById(t+"tempdiv"),null!=o&&(o.parentNode.removeChild(o),i.SWVideoChanel._Ocx_PlayObjMgr.FreePlayObj(o)),null!=n&&n.parentNode.removeChild(n);var r=t+"ocxeventid",a=document.getElementById(r);a&&a.parentNode.removeChild(a)}},_checkMedia:function(e,t){var n=0;for(var o in t)n|=t[o];return!!(e|n==n)},checkMedia:function(e){var t=!1;return(t=a.CheckOcx()?this._checkMedia(e,[i.MEDIADIR.VIDEORECV,i.MEDIADIR.AUDIORECV]):this._checkMedia(e,[i.MEDIADIR.VIDEORECV]))||console.log("the media dir you want to view is not support"),t}},swAlterVolume:function(e){return this._intercom._volumeProxy((function(t,n){if(void 0===e.volume)return i.RcCode.RC_CODE_E_BVCU_INVALIDARG;if(e.volume.icapture<0||e.volume.icapture>100||e.volume.iplay<0||e.volume.iplay>100)return i.RcCode.RC_CODE_E_BVCU_INVALIDARG;var o;if(a.CheckOcx()){var s=new proto.WEBBVCU.BVCU_DialogControlParam_Render;s.setIplackbackvolume(e.volume.iplay),s.setIcapturevolume(e.volume.icapture),o=this._commSendProxy(e,(function(){return{payload:s,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_ALTER_VIDEO_VOLUME,cmd:"swAlterVolume",hdlg:n}}))}else(o=this._autoDlgProxy(e,(function(t){var n=t.getVideoElement();return n?(n.volume=e.volume.iplay/100,i.RcCode.RC_CODE_S_OK):i.RcCode.RC_CODE_E_FAIL})))==i.RcCode.RC_CODE_E_NOTFOUND&&(o=i.RcCode.RC_CODE_S_OK),o==i.RcCode.RC_CODE_S_OK&&this.onAlterVolumeOk(t),i.SWVideoChanel.InterCom.delayInvoke(e.callback,o,e.tag);return o}),this)},onAlterVolumeOk:function(e){this._intercom.setVolume(e)},swGetVolume:function(e){var t=null,n=this._intercom._volumeProxy((function(e,n){return t=e,i.RcCode.RC_CODE_S_OK}),this);return i.RcCode.bSuccess(n)&&i.SWVideoChanel.InterCom.delayInvoke(e.callback,i.RcCode.RC_CODE_S_OK,e.tag,t),console.log("on get volume ok"),n},onIntercomOpenOk:function(e){return function(e,t){var n=e.cb;e.cb=function(e){n&&n(e),i.RcCode.RC_CODE_S_OK!=e&&t.swCloseIntercom()}}(e,this),this._intercom.onOpenHasResult(e)},onIntercomCloseOK:function(e){this._intercom.onCloseHasResult(e)},onAlterMedirDirOk:function(e,t,n){if(e){var o=this._commDlgMgr.get(n);o&&o.onMediaChange(t)}else this._intercom.onAlterHasResult(t)},swOpenCommand:function(e){var t={isSendAudio:!0,isRecvAudio:!1,callback:e.callback,tag:e.tag};return this.swOpenIntercom(t)},swCloseCommand:function(e){return this.swCloseIntercom(e)},swOpenIntercom:function(e){var t=this._intercom._openProxy((function(t){var n=((e=r.extend({},{isSendAudio:!0,isRecvAudio:!0,callback:null,tag:null},e||{})).isSendAudio?i.MEDIADIR.AUDIOSEND:i.MEDIADIR.ALLNULL)+(e.isRecvAudio?i.MEDIADIR.AUDIORECV:i.MEDIADIR.ALLNULL),o=new proto.WEBBVCU.CommonData;return o.setIdata1(n),this._commSendProxy(e,(function(){return{payload:o,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_OPEN_INTERCOM,cmd:"",hdlg:-1}}))}),this);return t},swCloseIntercom:function(e){return this._intercom._closeProxy((function(t){return this._commSendProxy(e,(function(){return{payload:null,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_CLOSE_INTERCOM,cmd:"",hdlg:t}}))}),this)},swAlterAudioDir:function(e){return this._intercom._alterProxy((function(t,n){var o=(t&i.MEDIADIR.AUDIORECV)==i.MEDIADIR.AUDIORECV,s=(t&i.MEDIADIR.AUDIOSEND)==i.MEDIADIR.AUDIOSEND,a={isSendAudio:s,isRecvAudio:o,callback:null,tag:null};if((e=r.extend({},a,e||{})).isRecvAudio==o&&e.isSendAudio==s)return console.log("i dont't think you should alter video dir, current status is you wished!"),i.RcCode.RC_CODE_S_OK;var l=(e.isRecvAudio?i.MEDIADIR.AUDIORECV:i.MEDIADIR.ALLNULL)+(e.isSendAudio?i.MEDIADIR.AUDIOSEND:i.MEDIADIR.ALLNULL),u=new proto.WEBBVCU.CommonData;return u.setIdata1(l),this._commSendProxy(e,(function(){return{payload:u,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_ALTER_AUDIO_DIALOG_DIR,cmd:"",hdlg:n}}))}),this)},swBIsIntercomOpened:function(){return this._intercom.bIsOpen()},swAlterVideoDir:function(e){return i.CallProtoType.OCX!=a.calltype?(console.error("only ocx support Alert, right now!"),i.RcCode.RC_CODE_E_UNSUPPORTED):this._autoDlgProxy(e,(function(t){if(null==t)return i.RcCode.RC_CODE_E_NOTFOUND;var n=t.getMedia(),o=(n&i.MEDIADIR.VIDEORECV)==i.MEDIADIR.VIDEORECV,a=(n&i.MEDIADIR.AUDIORECV)==i.MEDIADIR.AUDIORECV,l={isRecvAudio:a,isRecvVideo:o,div:null,callback:null,tag:null,hDlg:-1};if((e=r.extend({},l,e||{})).isRecvAudio==a&&e.isRecvVideo==o)return console.log("i dont't think you should alter video dir, current status is your wished!"),i.RcCode.RC_CODE_S_OK;var u=(e.isRecvAudio?i.MEDIADIR.AUDIORECV:i.MEDIADIR.ALLNULL)+(e.isRecvVideo?i.MEDIADIR.VIDEORECV:i.MEDIADIR.ALLNULL),c=new proto.WEBBVCU.CommonData;return c.setIdata1(u),e=r.extend({},l,e||{}),this._autoDlgSendProxy(e,(function(e){return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_ALTER_VIDEO_DIALOG_DIR,payload:c,cmd:s.RequestHeader.altervideodir.cmd}}))}))},swGetLocalRecord:function(e){return a.CheckNotOcx()?(console.error("only ocx support local record"),i.RcCode.RC_CODE_E_FAIL):this._autoDlgSendProxy(e,(function(){return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_LOCAL_RECORD}}))},swSetLocalRecord:function(e){if(a.CheckNotOcx())return console.error("only ocx support local record"),RC_CODE_E_FAIL;e=r.extend({},{szpath:"",ifileleninseconds:-1,callbak:null,recordCallback:null,tag:null},e||{});var t=new proto.WEBBVCU.LocalStorage;return t.setDir(r.string2Uint8Array(e.szpath)),t.setIfileleninseconds(Number(e.ifileleninseconds)),this._callbackAfterRecordHasResult=e.recordCallback,this._autoDlgSendProxy(e,(function(){return{payload:t,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_LOCAL_RECORD}}))},swSetNruRecord:function(e){e=r.extend({},{istart:0,ilength:-1,imediadir:0,callbak:null,recordCallback:null,tag:null},e||{});var t=new proto.BVCU.NRUConfig.ManualRecord;return t.setSzid(this._parent._id_pu),t.setIchannelindex(this._id_chanel),t.setBstart(e.istart),t.setIlength(e.ilength),t.setImediadir(e.imediadir),s.SendRequest({session:this._parent._parent,payload:t,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_SUBMETHOD_NRU_MANUALRECORD,callback:e.callback,tag:e.tag})},swGetUrl:function(){return this._url_chanel},swSnapshot:function(e){return e=r.extend({},{callback:null,tag:null},e||{}),this._autoDlgSendProxy(e,(function(){return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_SNAPSHOT}}))},swGetPtzAttr:function(e){if(null==this._parent&&this._parent._parent)return console.error("internal error, this._parent is null"),i.RcCode.RC_CODE_E_INVALIDARG;e=r.extend({},{callback:null,tag:null},e||{});var t=this._parent._parent,n=new s.BVCU_Command(this._parent._id_pu,this._id_chanel),o=s.RequestHeader.getptzattr,a=new s.JsonParamCommand(t._p_emms,o.requestHeader,n);return s._internalSend({cmd:s.RequestHeader.getptzattr.cmd,session:t,cmd:o.cmd,request:a,callback:e.callback,tag:e.tag})},swSetPtzAttr:function(e){},swPtzCtrl:function(e){if(null==this._parent&&this._parent._parent)return console.error("internal error, this._parent is null"),i.RcCode.RC_CODE_E_INVALIDARG;e=r.extend({},{ptzCtrl:{iPTZCommand:0,bStop:1,iParam1:0,iParam2:0,iParam3:0},callback:null,tag:null},e||{});var t=this._parent._parent,n=new proto.BVCU.PUConfig.PTZControl;n.setIptzcommand(e.ptzCtrl.iPTZCommand),n.setBstop(e.ptzCtrl.bStop),n.setIparam1(e.ptzCtrl.iParam1),n.setIparam2(e.ptzCtrl.iParam2),n.setIparam3(e.ptzCtrl.iParam3);var o=new s.BVCU_Command(this._parent._id_pu,this._id_chanel,n),a=new s.JsonParamCommand(t._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_SET_PTZ,o);return s._internalSend({cmd:s.RequestHeader.ptzctrl.cmd,session:t,request:a,callback:e.callback,tag:e.tag})},_swKeepLiveDlg:function(e){var t=e.getOpts(),n=this._autoDlgSendProxy(t,(function(){return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_KEEPALIVE,payload:null,cmd:s.RequestHeader.keeplive.cmd}}));return console.log("keeplive chanel: "+e.getInfo()),n},swKeepLive:function(){this._commDlgMgr.each(this._swKeepLiveDlg,this),this._intercom._keep_alive((function(e){var t={hdlg:e};this._commSendProxy(t,(function(){return{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_KEEPALIVE,payload:null,cmd:s.RequestHeader.keeplive.cmd}}))}),this)},swHide:function(e){return this._autoDlgProxy(e,(function(e,t,n,o){var s=e.getPlayDiv(),r=s+"_0077553";try{if(videojs&&"undefined"!=typeof videojs){var a=videojs(r);a&&a.dispose()}}catch(e){}var l=document.getElementById(r);return null!=l&&(l.style.display="none"),r=s.bv_uuid+"_0077554",null!=(l=document.getElementById(r))&&(l.style.display="none"),i.RcCode.RC_CODE_S_OK})),i.RcCode.RC_CODE_S_OK},swShow:function(e){this._autoDlgProxy(e,(function(e,t,n,o,i){var r=e.getPlayDiv(),a=e.getProteType();if(a==s.ProtoType.HLS||a==s.ProtoType.RTMP){var l=r.bv_uuid+"_0077553",u=document.getElementById(l);null!=u?u.style.display="block":((u=document.createElement("VIDEO")).setAttribute("id",l),u.setAttribute("class","video-js vjs-default-skin vjs-big-play-centered"),u.style.width="100%",u.style.height="100%",u.style.display="block",r.appendChild(u));try{if(0==e.bHttFlv){var c=this;videojs(l,{controlBar:!1,controls:!1},(function(){a==s.ProtoType.HLS?this.src({type:"application/vnd.apple.mpegurl",src:c.m_live_hls}):a==s.ProtoType.RTMP&&this.src({type:"rtmp/flv",src:c.m_live_rtmp}),this.play()}))}}catch(e){console.warn(e.message)}}else a==s.ProtoType.OCX&&(l=r.bv_uuid+"_0077554",null!=(u=document.getElementById(l))&&(u.style.display="block"),setTimeout(this._updateDialog.bind(this),500,i))}))},_clear:function(){this.swBIsIntercomOpened()&&this.swCloseIntercom(),this._commDlgMgr.each((function(e,t){t&&e&&t.swClose(e.getHDlg())}),this,this)},swClose:function(e){var t={hdlg:e};this._commDlgMgr.CanIDoClose();return!1,this._autoDlgSendProxy(t,(function(e){var t=e.getDlgParams();return i.DependencyMgr.GetModule("HttpFlv").ClosePlayer(e),{msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_CLOSE_CHANLE,payload:t,cmd:s.RequestHeader.closechanle.cmd,bcancel:!1}}),(function(e){var t=e.getPlayDiv();this._eventHandle.afterCloseDlgClearResource(t),this._commDlgMgr.free(e.getHDlg()),this._closeHasResult(!0),console.log("close chanel: "+e.getInfo())}))},compare:function(e){return!!this._parent.compare(e._parent)&&this._id_chanel==e._id_chanel}}},function(e,t,n){var o=n(0),i=o.jSW,s=o.jSWProtocol;o.jSWUtils,o.jSWOptions,o.PuLoad,o.AudioMgr,o.HTTPNruFile;i.CommonDlgMgr=function(e){this._session=e,this._arraydlg=[],this.prototype=-1},i.CommonDlgMgr.prototype={push:function(e){var t=this.buildKey(e.getHDlg());e!=this._arraydlg[t]&&(this._arraydlg[t]=e,this._arraydlg.length++),this.prototype=e._prototype},createAndSave:function(e,t){var n=new i.CommonDlg(e,t);return this.push(n,t),n},get:function(e){var t=this.buildKey(e);return this._arraydlg[t]},getSession:function(){return this._session},each:function(e,t,n){for(iindex in this._arraydlg)if(this._arraydlg[iindex])if(t){if(e.bind(t)(this._arraydlg[iindex],n))break}else if(e(this._arraydlg[iindex],n))break},free:function(e){null!=this._arraydlg[this.buildKey(e)]&&this._arraydlg.length--,this._arraydlg[this.buildKey(e)]=null},buildKey:function(e){return"dlg"+e},getDefault:function(){var e=null;return this.each((function(t){if(null==e)return e=t,!0})),e},CanIDoClose:function(){return!(s.ProtoType.RTMP==this.prototype&&this._arraydlg.length>1)}},i.CommonDlg=function(e,t){this._channel=e,this._hDlg=t,this._mdiv=null,this._dlgParams=null,this._media=0,this._rotate=0,this._prototype=-1,this._info="",this.bh265=!1},i.CommonDlg.prototype={getkey:function(){return this._hDlg},compare:function(e){return this.getkey()==e.getkey()},getHDlg:function(){return this._hDlg},getDlgParams:function(){return null==this._dlgParams&&(this._dlgParams=s.BVCU_DialogParam(this._channel._parent._id_pu,this._channel._id_chanel,0,this._prototype,0,0,this._hDlg)),this._dlgParams},getPlayDiv:function(){return this._mdiv},setParams:function(e,t,n,o){this._mdiv=e,this._hDlg=t,this._media=n,this._prototype=o},getMedia:function(){return this._media},getRotate:function(){return this._rotate},setRotate:function(e){this._rotate=e},getProteType:function(){return this._prototype},getOpts:function(e){return e||(e={hdl:-1}),e.hdlg=this._hDlg,e},getInfo:function(){return""==this._info&&(this._info=this._channel._parent._id_pu+" "+this._channel._id_chanel+" "+this._hDlg),this._info},onMediaChange:function(e){this._media=e},_reset:function(){this._media=0},setHdlg:function(e){this._hDlg=e},getVideoElement:function(){return(this._prototype==s.ProtoType.HLS||this._prototype==s.ProtoType.RTMP)&&this._dlgParams._mdiv&&this._dlgParams._mdiv.getElementsByTagName("video")?this._dlgParams._mdiv.getElementsByTagName("video")[0]:null}}},function(e,t,n){var o=n(0),i=o.jSW,s=(o.jSWProtocol,o.jSWUtils,o.jSWOptions),r=(o.PuLoad,o.AudioMgr);o.HTTPNruFile;i.SWVideoChanel.InterComStatus=function(){this._status=i.SWVideoChanel.InterComStatus.Types.INIT},i.SWVideoChanel.InterComStatus.Types={INIT:0,DOING:1,DONE:2},i.SWVideoChanel.InterComStatus.prototype={reset:function(){this._status=i.SWVideoChanel.InterComStatus.Types.INIT},setDoing:function(){this._status=i.SWVideoChanel.InterComStatus.Types.DOING},setDone:function(){this._status=i.SWVideoChanel.InterComStatus.Types.DONE},bInit:function(){return!s.CheckHttp()&&i.SWVideoChanel.InterComStatus.Types.INIT==this._status},bDoing:function(){return i.SWVideoChanel.InterComStatus.Types.DOING==this._status},bDone:function(){return i.SWVideoChanel.InterComStatus.Types.DONE==this._status}},i.SWVideoChanel.InterCom=function(e){this.status=new i.SWVideoChanel.InterComStatus,this._commDlg=new i.CommonDlg(e),this._channel=e,this._volume={icapture:50,iplay:50}},i.SWVideoChanel.InterCom.delayInvoke=function(e,t,n,o){var i={tag:n},s={emms:{code:t}};o?setTimeout(e,50,i,s,o):setTimeout(e,50,i,s)},i.SWVideoChanel.InterCom.prototype={_getCurMedia:function(){return this._commDlg.getMedia()},_getHdlg:function(){return this._commDlg.getHDlg()},_openProxy:function(e,t){var n=i.RcCode.RC_CODE_E_FAIL;return this.status.bDone()?(console.log("intercom has opened, can not be open twice! you can call swAlterAudioDir to change medir dir or close it try again!"),i.RcCode.RC_CODE_E_ALREADYEXIST):this.status.bDoing()?i.RcCode.RC_CODE_E_BUSY:(this.status.setDoing(),n=e.bind(t)(this._getCurMedia()),i.RcCode.bFaild(n)&&this.status.reset(),n)},_closeProxy:function(e,t){var n=i.RcCode.RC_CODE_E_FAIL;return this.status.bInit()?i.RcCode.RC_CODE_E_NOTFOUND:this.status.bDoing()?i.RcCode.RC_CODE_E_BUSY:(this.status.setDoing(),n=e.bind(t)(this._getHdlg()),i.RcCode.bFaild(n)&&this.status.setDone(),n)},_alterProxy:function(e,t){var n=i.RcCode.RC_CODE_E_FAIL;return this.status.bInit()?i.RcCode.RC_CODE_E_NOTFOUND:this.status.bDoing()?i.RcCode.RC_CODE_E_BUSY:(n=e.bind(t)(this._getCurMedia(),this._getHdlg()),i.RcCode.bFaild(n),n)},_volumeProxy:function(e,t){var n=i.RcCode.RC_CODE_E_FAIL;return this.status.bInit()?i.RcCode.RC_CODE_E_NOTFOUND:this.status.bDoing()?i.RcCode.RC_CODE_E_BUSY:(n=e.bind(t)(this.__getVolume(),this._getHdlg()),i.RcCode.bFaild(n),n)},__getVolume:function(){return{icapture:this._volume.icapture,iplay:this._volume.iplay}},setVolume:function(e){this._volume={icapture:e.icapture,iplay:e.iplay}},_clear:function(e,t){this.status.bDone()&&(e.bind(t)(this._getHdlg()),this._reset())},_keep_alive:function(e,t){this.status.bDone()&&e.bind(t)(this._getHdlg())},_reset:function(){this.status.reset(),this._commDlg._reset()},_check_media_has_audio_send:function(e){return(e&i.MEDIADIR.AUDIOSEND)==i.MEDIADIR.AUDIOSEND},onAlterHasResult:function(e){this._check_media_has_audio_send(e)?r.StartAudio():r.StopAudio(),this._commDlg.onMediaChange(e),this.status.setDone()},onOpenHasResult:function(e){var t=e.bresult;if(!t)return this._reset(),i.RcCode.RC_CODE_E_FAIL;var n=e.iMedia,o=e.hDlg;return this._commDlg.onMediaChange(n),this._commDlg.setHdlg(o),this.status.setDone(),t&&this._check_media_has_audio_send(n)&&r.StartAudio(e),i.RcCode.RC_CODE_S_OK},onCloseHasResult:function(e){this._reset(),e&&r.StopAudio()},bIsOpen:function(){return this.status.bDone()}}},function(e,t,n){var o=n(0),i=o.jSW,s=o.jSWProtocol;o.jSWUtils,o.jSWOptions,o.PuLoad,o.AudioMgr,o.HTTPNruFile;i.SWGPSChanel=function(e,t){this._parent=e,this._updateInfo(t),this.m_is_open=!1,this._callback=null,this._hDlg=-1,this._bDlgOpened=!1},i.SWGPSChanel.prototype={_updateInfo:function(e){this._info_chanel={id:e.ichannelindex,name:e.szname,ptz:e.iptz,media:e.imediadir>>10,status:1023&e.imediadir},this._id_chanel=this._info_chanel.id,this._name_chanle=this._info_chanel.name},swClose:function(){var e=s.SendRequest({session:this._parent._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_PUGPS_CHANNEL_CLOSE,target:this._parent._id_pu,targetIndex:this._id_chanel,tag:options.tag,hdlg:this._hDlg});return this._hDlg=-1,this.m_is_open=!1,this._bDlgOpened=!1,e},swOpen:function(e){return null==this._parent||null==this._parent._parent?(console.error("internal error, this._parent is null"),i.RcCode.RC_CODE_E_INVALIDARG):this.m_is_open?i.RcCode.RC_CODE_E_BUSY:(this.m_is_open=!0,this._callback=e.callback,this._tag=e.tag,s.SendRequest({session:this._parent._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_OPEN_PUGPS_CHANNEL,target:this._parent._id_pu,targetIndex:this._id_chanel,callback:e.callback,tag:e.tag}))},_OnOpenGpsHasResult:function(e,t){i.RcCode.bSuccess(e)?(this._hDlg=t,this._bDlgOpened=!0):(this.m_is_open=!1,this._bDlgOpened=!1,this._hDlg=-1)},_tickGpsData:function(e){if(this._callback&&this._bDlgOpened)try{this._callback({tag:this._tag},{gps:e,emms:{code:0}},e)}catch(e){console.log(e)}},swGetGpsAttr:function(e){return s.SendRequest({session:this._parent._parent,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_GET_PU_GPS,target:this._parent._id_pu,targetIndex:this._id_chanel,callback:e.callback,tag:e.tag})},swSetPuGpsAttr:function(e){return this.swGetGpsAttr({chanelid:e.chanelid,callback:function(t,n,o){var i=new proto.BVCU.PUConfig.GPSParam,r=t.tag,a=r.options;return i.setBenable(a.isenable),i.setIsetupsatellitesignal(o.isetupsatellitesignal),i.setIreportinterval(o.ireportinterval),i.setIreportdistance(o.ireportdistance),s.SendRequest({session:r.session,msgtype:proto.WEBBVCU.MSGType.WEB_BVCU_SET_PU_GPS,target:r.puid,targetIndex:this._id_chanel,payload:i,callback:e.callback,tag:r.options.tag})},tag:{session:this._parent._parent,options:e,puid:this._parent._id_pu}})}}},function(e,t,n){var o=n(0),i=o.jSW,s=o.jSWProtocol,r=o.jSWUtils;o.jSWOptions,o.PuLoad,o.AudioMgr,o.HTTPNruFile;i.SWTSPChanel=function(e,t){this._parent=e,this._info_chanel={id:t.ichannelindex,name:t.szname,ptz:t.iptz,media:t.imediadir>>10,status:1023&t.imediadir},this._id_chanel=this._info_chanel.id,this._name_chanle=this._info_chanel.name,this._tspDigLog=null},i.SWTSPChanel.prototype={_OnTspDialog:function(e){this._tspDigLog=e},_updateInfo:function(e){this._info_chanel={id:e.ichannelindex,name:e.szname,ptz:e.iptz,media:e.imediadir>>10,status:1023&e.imediadir},this._id_chanel=this._info_chanel.id,this._name_chanle=this._info_chanel.name,this._meida_chanel=this._info_chanel.media,this._ptz_chanel=this._info_chanel.ptz},swClose:function(){if(null==this._parent||null==this._parent._parent)return console.warn("internal error, this._parent is null"),i.RcCode.RC_CODE_E_INVALIDARG;if(null==this._tspDigLog)return i.RcCode.RC_CODE_OK;var e=this._parent._parent,t=s.BVCU_DialogParam(this._parent._id_pu,this._id_chanel,0,s.ProtoType.OTHER,0,0,this._tspDigLog._hDlg),n=s.JsonParamDialog(e._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_CLOSE_CHANLE,t),o=s._internalSend({cmd:s.RequestHeader.closechanle.cmd,session:e,request:n});return this._tspDigLog=null,console.log("close chanel: "+this._parent._id_pu+" "+this._id_chanel),o},swOpen:function(e){if(null==this._parent||null==this._parent._parent)return console.error("internal error, this._parent is null"),i.RcCode.RC_CODE_E_INVALIDARG;var t=this._parent._parent,n=s.BVCU_DialogParam(this._parent._id_pu,this._id_chanel,0,s.ProtoType.OTHER,0),o=s.JsonParamDialog(t._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_OPEN_CHANLE_TSP,n);return e=r.extend({},{callback:null,tag:null},e||{}),s._internalSend({cmd:s.RequestHeader.openchanletsp.cmd,session:t,request:o,callback:e.callback,tag:e.tag})},swWrite:function(e){if(null==this._parent||null==this._parent._parent)return console.error("internal error, this._parent is null"),i.RcCode.RC_CODE_E_INVALIDARG;if(null==e.data)return console.error("write data is null"),i.RcCode.RC_CODE_E_INVALIDARG;var t=this._parent._parent,n=new proto.WEBBVCU.Notify_TSP_Data;if(n.setTargetid(this._parent._id_pu),n.setTargetindex(this._id_chanel),e.data instanceof Uint8Array);else if(e.data instanceof Array){var o=new Uint8Array(e.data.length),a=null;for(iiteindex in e.data)a=(a=e.data[iiteindex]).replace("0x",""),o[iiteindex]+=16*Number(a.charAt(0)),o[iiteindex]+=Number(a.charAt(1));e.data=o}else e.data=r.string2Uint8Array(e.data);n.setData(e.data);var l=s.JsonParamTSPDialog(t._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_WRITE_CHANLE_TSP,n);l.setHdlg(this._tspDigLog._hDlg);return e=r.extend({},{callback:null,data:null,tag:null},e||{}),s._internalSend({cmd:s.RequestHeader.writechanletsp.cmd,session:t,request:l,callback:e.callback,tag:e.tag})},swKeepLive:function(){if(null==this._parent&&this._parent._parent)return console.error("internal error, this._parent is null"),i.RcCode.RC_CODE_E_INVALIDARG;var e=this._parent._parent,t=new s.BVCU_DialogParam(this._parent._id_pu,this._id_chanel,0,s.ProtoType.OTHER,0),n=new s.JsonParamDialog(e._p_emms,proto.WEBBVCU.MSGType.WEB_BVCU_KEEPALIVE,t),o=s._internalSend({cmd:s.RequestHeader.keeplivechanle.cmd,session:e,request:n});return console.log("keeplive tsp chanel: "+t.getId()+" "+t.getMajor()),o},compare:function(e){return!!this._parent.compare(e._parent)&&this._id_chanel==e._id_chanel}}}]);