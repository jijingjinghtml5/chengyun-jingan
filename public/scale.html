<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>自适应版</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
      }
      html {
        width: 100%;
        height: 100%;
        background: #0a1b21;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <noscript>
      <strong>We're sorry but chengyun-town doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
  </body>
  <script type="text/javascript">
    (function(_rw, _rh, _pn) {
      function _getParams() {
        return (window.location.href.match(/[?&]?(\w+)=[^&#/]*/g) || []).reduce(function(r, d){
          var splitArr = d.split("=");
          var k = splitArr[0].slice(1);
          var value = decodeURIComponent(splitArr[1]);
          r[k] = value;
          return r;
        }, {})
      }

      function _addIframe(url) {
        var iframe = document.createElement("iframe");
        iframe.scrolling = "no";
        iframe.setAttribute("frameborder", "0");
        iframe.setAttribute("allowTransparency", true);
        iframe.setAttribute("allowfullscreen", true);
        iframe.width = "100%";
        iframe.height = "100%";
        iframe.src = url;
        document.body.appendChild(iframe);
      }

      function _scale(w, h) {
        var B = document.body,
            C = w / h,
            t = 1;
        B.style.cssText += ';width:' + w + 'px;height:' + h + 'px;overflow:hidden';
        var n = parseInt(window.innerWidth || window.document.documentElement.clientWidth),
          v = parseInt(window.innerHeight || window.document.documentElement.clientHeight),
          k = (n / w) < (v / h) ? (n / w) : (v / h);
        var mt, ml;
        if ((n / w) < (v / h)) {
          k = (n / w);
          mt = (v - h * k) / 2;
          ml = 0
        } else {
          k = (v / h);
          mt = 0;
          ml = (n - w * k) / 2
        }
        B.style.cssText += ';transform:scale(' + k + ');-ms-transform:scale(' + k + ');-moz-transform:scale(' + k + ');-webkit-transform:scale(' + k + ');-o-transform:scale(' + k + ');transform-origin:left top;-ms-transform-origin:left top;-moz-transform-origin:left top;-webkit-transform-origin:left top;-o-transform-origin:left top;margin-left:' + ml + 'px;margin-top:' + mt + 'px';
      };

      function _debounce(fn, wait) {
        let timer = null;
        return function() {
          var ctx = this;
          var args = arguments;
          if (timer) {
            clearTimeout(timer);
            timer = null;
          }
          timer = setTimeout(function(){
            fn.apply(ctx, args);
          }, wait || 500)
        }
      }

      function _listeners() {
        window.addEventListener("resize", _debounce(function() {
          _scale(_rw, _rh)
        }))
      }
      var params = _getParams();
      var _pn_h = (params["_pn_h"] && params["_pn_h"] !== "0") ? params["_pn_h"] : 0;
      var iframeUrl = window.location.href.replace(/[^/]+\.html/, !_pn_h ? (params["_pn"] || _pn) + ".html" : "#/" + (params["_pn"] || _pn));
      _scale(parseInt(params["_rw"] || _rw), parseInt(params["_rh"] || _rh));
      _addIframe(iframeUrl);
      _listeners();
    })(7680, 2160, "page1")
</script>
</html>
